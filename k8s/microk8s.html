<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用 microk8s 安装单节点 k8s 集群 | xxred&#39;s notes</title>
    <meta name="description" content="记录学习过程，收集学习资源">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3ab1ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/logo.jpg">
  <meta name="msapplication-TileImage" content="/logo.jpg">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.5203916d.css" as="style"><link rel="preload" href="/assets/js/app.fe997443.js" as="script"><link rel="preload" href="/assets/js/2.bd7d8131.js" as="script"><link rel="preload" href="/assets/js/120.6b7a7008.js" as="script"><link rel="prefetch" href="/assets/js/10.12125ec3.js"><link rel="prefetch" href="/assets/js/100.4234c37a.js"><link rel="prefetch" href="/assets/js/101.fb88bb04.js"><link rel="prefetch" href="/assets/js/102.40b3dadf.js"><link rel="prefetch" href="/assets/js/103.41fa7563.js"><link rel="prefetch" href="/assets/js/104.8ef181ab.js"><link rel="prefetch" href="/assets/js/105.72cf60e8.js"><link rel="prefetch" href="/assets/js/106.0abd5aa6.js"><link rel="prefetch" href="/assets/js/107.ff55f337.js"><link rel="prefetch" href="/assets/js/108.24a9ce4e.js"><link rel="prefetch" href="/assets/js/109.b4a99fb6.js"><link rel="prefetch" href="/assets/js/11.2f59486f.js"><link rel="prefetch" href="/assets/js/110.6fa757bd.js"><link rel="prefetch" href="/assets/js/111.ea6ddb1d.js"><link rel="prefetch" href="/assets/js/112.6d308a6f.js"><link rel="prefetch" href="/assets/js/113.63df4be2.js"><link rel="prefetch" href="/assets/js/114.da3494ea.js"><link rel="prefetch" href="/assets/js/115.27bfeed2.js"><link rel="prefetch" href="/assets/js/116.be20f9a5.js"><link rel="prefetch" href="/assets/js/117.d337a1a3.js"><link rel="prefetch" href="/assets/js/118.63c937a7.js"><link rel="prefetch" href="/assets/js/119.a9ffa7b6.js"><link rel="prefetch" href="/assets/js/12.f7c6dc20.js"><link rel="prefetch" href="/assets/js/121.3e7d2cba.js"><link rel="prefetch" href="/assets/js/122.523e7cd8.js"><link rel="prefetch" href="/assets/js/123.0fd9b25a.js"><link rel="prefetch" href="/assets/js/124.2e62274a.js"><link rel="prefetch" href="/assets/js/125.09eede00.js"><link rel="prefetch" href="/assets/js/126.0ae8bd82.js"><link rel="prefetch" href="/assets/js/127.e608d8a6.js"><link rel="prefetch" href="/assets/js/128.d6e30abd.js"><link rel="prefetch" href="/assets/js/129.f0a9693a.js"><link rel="prefetch" href="/assets/js/13.39a5d82f.js"><link rel="prefetch" href="/assets/js/130.dffecd14.js"><link rel="prefetch" href="/assets/js/131.2de06ec9.js"><link rel="prefetch" href="/assets/js/132.e3ada141.js"><link rel="prefetch" href="/assets/js/133.5667a441.js"><link rel="prefetch" href="/assets/js/134.725d4727.js"><link rel="prefetch" href="/assets/js/135.c2dbf7c4.js"><link rel="prefetch" href="/assets/js/136.efdbe0b9.js"><link rel="prefetch" href="/assets/js/137.2911894a.js"><link rel="prefetch" href="/assets/js/138.b73ed851.js"><link rel="prefetch" href="/assets/js/139.8cd48b12.js"><link rel="prefetch" href="/assets/js/14.1ee918de.js"><link rel="prefetch" href="/assets/js/140.67a19657.js"><link rel="prefetch" href="/assets/js/141.15dfdae9.js"><link rel="prefetch" href="/assets/js/142.650ca2d0.js"><link rel="prefetch" href="/assets/js/143.00418d9c.js"><link rel="prefetch" href="/assets/js/144.c520caa4.js"><link rel="prefetch" href="/assets/js/145.421b6b25.js"><link rel="prefetch" href="/assets/js/146.1f83d1e4.js"><link rel="prefetch" href="/assets/js/147.1dbe6f51.js"><link rel="prefetch" href="/assets/js/148.f334bc1a.js"><link rel="prefetch" href="/assets/js/149.8ee313ac.js"><link rel="prefetch" href="/assets/js/15.4672c2ce.js"><link rel="prefetch" href="/assets/js/150.450e6848.js"><link rel="prefetch" href="/assets/js/151.b9e8ecb0.js"><link rel="prefetch" href="/assets/js/152.71ad49bb.js"><link rel="prefetch" href="/assets/js/153.c3092733.js"><link rel="prefetch" href="/assets/js/154.99d2394b.js"><link rel="prefetch" href="/assets/js/155.44ca1555.js"><link rel="prefetch" href="/assets/js/156.ccb58114.js"><link rel="prefetch" href="/assets/js/157.f630a2d5.js"><link rel="prefetch" href="/assets/js/158.a5dc3b43.js"><link rel="prefetch" href="/assets/js/159.a64ae775.js"><link rel="prefetch" href="/assets/js/16.2c9264be.js"><link rel="prefetch" href="/assets/js/160.2103bd47.js"><link rel="prefetch" href="/assets/js/161.f5c974a7.js"><link rel="prefetch" href="/assets/js/162.b8976f76.js"><link rel="prefetch" href="/assets/js/163.6e5c2cb3.js"><link rel="prefetch" href="/assets/js/164.b79d9b22.js"><link rel="prefetch" href="/assets/js/165.bb14bc1e.js"><link rel="prefetch" href="/assets/js/166.3fcad838.js"><link rel="prefetch" href="/assets/js/167.5b1c24ef.js"><link rel="prefetch" href="/assets/js/168.ac0f561d.js"><link rel="prefetch" href="/assets/js/169.6f63b76e.js"><link rel="prefetch" href="/assets/js/17.10c00e1c.js"><link rel="prefetch" href="/assets/js/170.8f0ca16f.js"><link rel="prefetch" href="/assets/js/171.97a2dd4a.js"><link rel="prefetch" href="/assets/js/172.970a09a9.js"><link rel="prefetch" href="/assets/js/173.d8088e32.js"><link rel="prefetch" href="/assets/js/18.c6c1373f.js"><link rel="prefetch" href="/assets/js/19.9d270ada.js"><link rel="prefetch" href="/assets/js/20.c8e2904f.js"><link rel="prefetch" href="/assets/js/21.3f9d4e34.js"><link rel="prefetch" href="/assets/js/22.cad1523d.js"><link rel="prefetch" href="/assets/js/23.259be601.js"><link rel="prefetch" href="/assets/js/24.b4abaff4.js"><link rel="prefetch" href="/assets/js/25.c833357f.js"><link rel="prefetch" href="/assets/js/26.6b4963fa.js"><link rel="prefetch" href="/assets/js/27.feecf00a.js"><link rel="prefetch" href="/assets/js/28.b65bb789.js"><link rel="prefetch" href="/assets/js/29.1b8ea69b.js"><link rel="prefetch" href="/assets/js/3.f12ab206.js"><link rel="prefetch" href="/assets/js/30.8ddb0c4f.js"><link rel="prefetch" href="/assets/js/31.6fa56055.js"><link rel="prefetch" href="/assets/js/32.9dc1eb16.js"><link rel="prefetch" href="/assets/js/33.ae1bb72c.js"><link rel="prefetch" href="/assets/js/34.ee437a9e.js"><link rel="prefetch" href="/assets/js/35.d99ba2ba.js"><link rel="prefetch" href="/assets/js/36.138fdeda.js"><link rel="prefetch" href="/assets/js/37.283e7743.js"><link rel="prefetch" href="/assets/js/38.1757d792.js"><link rel="prefetch" href="/assets/js/39.f8cf5b6c.js"><link rel="prefetch" href="/assets/js/4.be1f9f70.js"><link rel="prefetch" href="/assets/js/40.9ca03b00.js"><link rel="prefetch" href="/assets/js/41.6083da11.js"><link rel="prefetch" href="/assets/js/42.4634ccd9.js"><link rel="prefetch" href="/assets/js/43.ecd071d7.js"><link rel="prefetch" href="/assets/js/44.27ea6552.js"><link rel="prefetch" href="/assets/js/45.65c7a130.js"><link rel="prefetch" href="/assets/js/46.4ef460cb.js"><link rel="prefetch" href="/assets/js/47.1e54e656.js"><link rel="prefetch" href="/assets/js/48.0ef3ff92.js"><link rel="prefetch" href="/assets/js/49.fda2074a.js"><link rel="prefetch" href="/assets/js/5.08d71a27.js"><link rel="prefetch" href="/assets/js/50.4ef0b7b7.js"><link rel="prefetch" href="/assets/js/51.8cc1d866.js"><link rel="prefetch" href="/assets/js/52.2d762f88.js"><link rel="prefetch" href="/assets/js/53.b4d41aff.js"><link rel="prefetch" href="/assets/js/54.18171ff9.js"><link rel="prefetch" href="/assets/js/55.c18f433b.js"><link rel="prefetch" href="/assets/js/56.12cb712c.js"><link rel="prefetch" href="/assets/js/57.a0ec922a.js"><link rel="prefetch" href="/assets/js/58.6519b18b.js"><link rel="prefetch" href="/assets/js/59.2623d744.js"><link rel="prefetch" href="/assets/js/6.c61c395f.js"><link rel="prefetch" href="/assets/js/60.211d2b20.js"><link rel="prefetch" href="/assets/js/61.644933f7.js"><link rel="prefetch" href="/assets/js/62.587e2797.js"><link rel="prefetch" href="/assets/js/63.56032f76.js"><link rel="prefetch" href="/assets/js/64.78982861.js"><link rel="prefetch" href="/assets/js/65.ece79ff7.js"><link rel="prefetch" href="/assets/js/66.61860889.js"><link rel="prefetch" href="/assets/js/67.f25ce81e.js"><link rel="prefetch" href="/assets/js/68.0345cfc9.js"><link rel="prefetch" href="/assets/js/69.82ab549f.js"><link rel="prefetch" href="/assets/js/7.e8efcd8e.js"><link rel="prefetch" href="/assets/js/70.851ae20b.js"><link rel="prefetch" href="/assets/js/71.30bd4bec.js"><link rel="prefetch" href="/assets/js/72.5f406357.js"><link rel="prefetch" href="/assets/js/73.68038883.js"><link rel="prefetch" href="/assets/js/74.3f914abb.js"><link rel="prefetch" href="/assets/js/75.191b4e18.js"><link rel="prefetch" href="/assets/js/76.03c65416.js"><link rel="prefetch" href="/assets/js/77.53879b2a.js"><link rel="prefetch" href="/assets/js/78.89320b6f.js"><link rel="prefetch" href="/assets/js/79.33bfb013.js"><link rel="prefetch" href="/assets/js/8.d2b4ba16.js"><link rel="prefetch" href="/assets/js/80.11fef7ed.js"><link rel="prefetch" href="/assets/js/81.28987bd4.js"><link rel="prefetch" href="/assets/js/82.37bf2a82.js"><link rel="prefetch" href="/assets/js/83.8951afa1.js"><link rel="prefetch" href="/assets/js/84.0a204e55.js"><link rel="prefetch" href="/assets/js/85.16f550e0.js"><link rel="prefetch" href="/assets/js/86.ce149547.js"><link rel="prefetch" href="/assets/js/87.db64037c.js"><link rel="prefetch" href="/assets/js/88.2aeeb103.js"><link rel="prefetch" href="/assets/js/89.8d8a0d17.js"><link rel="prefetch" href="/assets/js/9.4bf1e77a.js"><link rel="prefetch" href="/assets/js/90.1f05139f.js"><link rel="prefetch" href="/assets/js/91.8533233c.js"><link rel="prefetch" href="/assets/js/92.6f139898.js"><link rel="prefetch" href="/assets/js/93.91e50d2d.js"><link rel="prefetch" href="/assets/js/94.a66f49cc.js"><link rel="prefetch" href="/assets/js/95.5151e3ed.js"><link rel="prefetch" href="/assets/js/96.d693c491.js"><link rel="prefetch" href="/assets/js/97.c3aab7a8.js"><link rel="prefetch" href="/assets/js/98.a0144b3b.js"><link rel="prefetch" href="/assets/js/99.42e053b5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5203916d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xxred's notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Easy.Admin</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/easy-admin/" class="nav-link">Easy.Admin文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Easy.Admin</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/easy-admin/" class="nav-link">Easy.Admin文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>k8s</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/k8s/" class="sidebar-link">/k8s/</a></li><li><a href="/k8s/microk8s.html" class="active sidebar-link">使用 microk8s 安装单节点 k8s 集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/k8s/microk8s.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/k8s/microk8s.html#问题排查" class="sidebar-link">问题排查</a></li><li class="sidebar-sub-header"><a href="/k8s/microk8s.html#下载镜像" class="sidebar-link">下载镜像</a></li><li class="sidebar-sub-header"><a href="/k8s/microk8s.html#dashboard" class="sidebar-link">dashboard</a></li><li class="sidebar-sub-header"><a href="/k8s/microk8s.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用-microk8s-安装单节点-k8s-集群"><a href="#使用-microk8s-安装单节点-k8s-集群" aria-hidden="true" class="header-anchor">#</a> 使用 microk8s 安装单节点 k8s 集群</h1> <ul><li>microk8s 适用于 42 种 Linux 版本的单一 k8s 包。专为开发人员而设计，非常适合边缘，物联网和电器。由于总所周知的网络原因，默认的镜像包下载地址无法访问，本文可作为第一次安装的人的一份参考</li></ul> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <ul><li>安装环境为 ubuntu18.04，此系统已内置 snap，可以直接通过 snap 安装</li> <li>安装命令<code>sudo snap install microk8s --classic</code></li> <li>或者选择其他系列版本，如<code>v1.14</code>。<code>v1.14</code>版本开始，容器运行时默认改为<a href="https://containerd.io/" target="_blank" rel="noopener noreferrer">containerd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 。命令<code>snap install microk8s --classic --channel=1.14/stable</code></li> <li>这里我选择安装<code>v1.15</code>系列的，<code>snap install microk8s --classic --channel=1.15/stable</code></li> <li>安装完成，使用命令<code>microk8s.status</code>查看<code>microk8s</code>是否可用。安装完成将有如下输出：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>microk8s is running
addons:
knative: disabled
jaeger: disabled
fluentd: disabled
gpu: disabled
cilium: disabled
storage: disabled
registry: disabled
rbac: disabled
ingress: disabled
dns: disabled
metrics-server: disabled
linkerd: disabled
prometheus: disabled
istio: disabled
dashboard: disabled
</code></pre></div><ul><li>为了避免与已安装的 kubectl 发生冲突并避免覆盖任何现有的 Kubernetes 配置文件，MicroK8s 添加了一个 microk8s.kubectl 命令，配置为专门访问新的 MicroK8s 安装。在使用 kubectl 时，确保前缀 kubectl 用 microk8s，如：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>microk8s.kubectl get nodes
microk8s.kubectl get services
</code></pre></div><ul><li>如果 kubectl 没有安装过，则可以别名 microk8s.kubectl 来 kubectl 使用下面的命令<code>snap alias microk8s.kubectl kubectl</code>，恢复命令<code>snap unalias kubectl</code></li> <li>如果已经安装了 kubectl，可以用下面的命令覆盖配置文件：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>microk8s.kubectl config view --raw <span class="token operator">&gt;</span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre></div><h2 id="问题排查"><a href="#问题排查" aria-hidden="true" class="header-anchor">#</a> 问题排查</h2> <ul><li>安装过程通过命令<code>microk8s.inspect</code>排查，通过命令<code>journalctl -u snap.microk8s.&lt;daemon&gt;.service</code>查看有问题的服务的日志。所有服务<code>running</code>以及没有<code>WARNING</code>就是安装成功了。以下是一个例子，需要配置防火墙：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>Inspecting services
  Service snap.microk8s.daemon-containerd is running
  Service snap.microk8s.daemon-apiserver is running
  Service snap.microk8s.daemon-proxy is running
  Service snap.microk8s.daemon-kubelet is running
  Service snap.microk8s.daemon-scheduler is running
  Service snap.microk8s.daemon-controller-manager is running
  Service snap.microk8s.daemon-etcd is running
  Copy <span class="token function">service</span> arguments to the final report tarball
Inspecting AppArmor configuration
Gathering system information
  Copy processes list to the final report tarball
  Copy snap list to the final report tarball
  Copy VM name <span class="token punctuation">(</span>or none<span class="token punctuation">)</span> to the final report tarball
  Copy disk usage information to the final report tarball
  Copy memory usage information to the final report tarball
  Copy server <span class="token function">uptime</span> to the final report tarball
  Copy current linux distribution to the final report tarball
  Copy openSSL information to the final report tarball
  Copy network configuration to the final report tarball
Inspecting kubernetes cluster
  Inspect kubernetes cluster

 WARNING:  IPtables FORWARD policy is DROP. Consider enabling traffic forwarding with: <span class="token function">sudo</span> iptables -P FORWARD ACCEPT
The change can be made persistent with: <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> iptables-persistent
Building the report tarball
  Report tarball is at /var/snap/microk8s/826/inspection-report-20190906_092912.tar.gz
</code></pre></div><ul><li>通过命令解决：<code>sudo iptables -P FORWARD ACCEPT</code>，利用<code>ufw</code>持久化这些配置<code>sudo ufw default allow routed</code></li></ul> <h2 id="下载镜像"><a href="#下载镜像" aria-hidden="true" class="header-anchor">#</a> 下载镜像</h2> <h3 id="修改-sandbox-image"><a href="#修改-sandbox-image" aria-hidden="true" class="header-anchor">#</a> 修改 sandbox_image</h3> <ul><li>不修改也行，使用下面加载镜像的脚本，也能得到 <code>k8s.gcr.io/pause:3.1</code></li> <li>编辑<code>/var/snap/microk8s/current/args/containerd.template.toml</code>文件，sandbox_image 处修改为：</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">plugins.cri</span><span class="token punctuation">]</span>
    <span class="token key property">sandbox_image</span> <span class="token punctuation">=</span> <span class="token string">&quot;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1&quot;</span>
</code></pre></div><h3 id="更换镜像源"><a href="#更换镜像源" aria-hidden="true" class="header-anchor">#</a> 更换镜像源</h3> <ul><li>编辑<code>/var/snap/microk8s/current/args/containerd.template.toml</code>文件，mirrors 处修改为：</li></ul> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">plugins</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token table class-name">plugins.cri</span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token table class-name">plugins.cri.registry</span><span class="token punctuation">]</span>
      <span class="token punctuation">[</span><span class="token table class-name">plugins.cri.registry.mirrors</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token table class-name">plugins.cri.registry.mirrors.&quot;docker.io&quot;</span><span class="token punctuation">]</span>
          <span class="token key property">endpoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://registry.docker-cn.com&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token table class-name">plugins.cri.registry.mirrors.&quot;local.insecure-registry.io&quot;</span><span class="token punctuation">]</span>
          <span class="token key property">endpoint</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;http://localhost:32000&quot;</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>修改完以上配置之后重启：<code>microk8s.stop &amp;&amp; microk8s.start</code></li> <li>默认镜像下载地址是<code>k8s.gcr.io</code>，我们通过镜像下载到本地，再修改标签的方式解决这个网络问题</li> <li>命令如下：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">images</span><span class="token operator">=</span><span class="token punctuation">(</span>
k8s.gcr.io/pause:3.1<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/google-containers/pause:3.1
gcr.io/google_containers/defaultbackend-amd64:1.4<span class="token operator">=</span>gcr.azk8s.cn/google-containers/defaultbackend-amd64:1.4
k8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1
k8s.gcr.io/heapster-influxdb-amd64:v1.3.3<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-influxdb-amd64:v1.3.3
k8s.gcr.io/heapster-amd64:v1.5.2<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-amd64:v1.5.2
k8s.gcr.io/heapster-grafana-amd64:v4.4.3<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-grafana-amd64:v4.4.3
<span class="token punctuation">)</span>

<span class="token assign-left variable">OIFS</span><span class="token operator">=</span><span class="token environment constant">$IFS</span><span class="token punctuation">;</span> <span class="token comment"># 保存旧值</span>

<span class="token keyword">for</span> <span class="token for-or-select variable">image</span> <span class="token keyword">in</span> <span class="token variable">${images<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">;</span><span class="token keyword">do</span>
    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">'='</span>
    <span class="token builtin class-name">set</span> <span class="token variable">$image</span>
    docker pull <span class="token variable">$2</span>
    docker tag  <span class="token variable">$2</span> <span class="token variable">$1</span>
    docker rmi  <span class="token variable">$2</span>
    docker save <span class="token variable">$1</span> <span class="token operator">&gt;</span> <span class="token number">1</span>.tar <span class="token operator">&amp;&amp;</span> microk8s.ctr -n k8s.io  i <span class="token function">import</span> <span class="token number">1</span>.tar <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token number">1</span>.tar
    <span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token variable">$OIFS</span><span class="token punctuation">;</span> <span class="token comment"># 还原旧值</span>
<span class="token keyword">done</span>
</code></pre></div><h3 id="查看需要的镜像"><a href="#查看需要的镜像" aria-hidden="true" class="header-anchor">#</a> 查看需要的镜像</h3> <ul><li>通过命令 <code>microk8s.kubectl get all -A</code>查看名字是<code>pod/</code>开头的，找到 pod 对应名称，然后使用命令<code>microk8s.kubectl describe pod kubernetes-dashboard-7d75c474bb-44789 -n kube-system</code>查看输出最后的事件，事件描述了需要拉取哪个镜像。当启用某个插件的时候，因网络问题无法启动，可通过此方法找到所需镜像，再根据上述命令从别的地方拉取</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>  NAMESPACE NAME READY STATUS RESTARTS AGE
  kube-system pod/kubernetes-dashboard-7d75c474bb-44789 <span class="token number">1</span>/1 Running <span class="token number">0</span> 4d
</code></pre></div><h2 id="dashboard"><a href="#dashboard" aria-hidden="true" class="header-anchor">#</a> dashboard</h2> <ul><li>Kubernetes Dashboard 是 Kubernetes 集群的基于 Web 的通用 UI。它允许用户管理在群集中运行的应用程序并对其进行故障排除，以及管理群集本身</li> <li>默认情况下，dashboard 部署完会自动生成一个证书，但是这个证书貌似不是很好使，一般浏览器不放行，只有火狐浏览器能忽略风险继续访问，因此需要用自己的证书替换，只需要在启用 dashboard 前，在与 dashboard 相同命名空间下创建名为
kubernetes-dashboard-certs 的密钥</li></ul> <h3 id="生成证书"><a href="#生成证书" aria-hidden="true" class="header-anchor">#</a> 生成证书</h3> <ul><li>可以用<a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">Let's Encrypt<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>生成证书，或者使用自签名证书，参考 https://github.com/kubernetes/dashboard/blob/master/docs/user/certificate-management.md</li> <li>以下使用 openssl 生成证书，当提示输入密码时直接回车跳过即可</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 生成dashboard.key私钥和dashboard.csr文件</span>
openssl genrsa -des3 -passout pass:123456 -out dashboard.pass.key <span class="token number">2048</span>
openssl rsa -passin pass:123456 -in dashboard.pass.key -out dashboard.key
<span class="token function">rm</span> dashboard.pass.key
openssl req -new -key dashboard.key -out dashboard.csr
<span class="token comment"># SSL证书</span>
openssl x509 -req -sha256 -days <span class="token number">365</span> -in dashboard.csr -signkey dashboard.key -out dashboard.crt
<span class="token function">rm</span> dashboard.csr
<span class="token function">mkdir</span> certs <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> dashboard.key dashboard.crt certs
</code></pre></div><h3 id="创建密钥"><a href="#创建密钥" aria-hidden="true" class="header-anchor">#</a> 创建密钥</h3> <ul><li>自定义证书必须存储在与 Kubernetes Dashboard 相同的命名空间中的 kubernetes-dashboard-certs 密钥中。将 dashboard.crt 和 dashboard.key 文件存储在 certs 目录下，然后用这些文件的内容创建密钥</li> <li>参考 https://github.com/kubernetes/dashboard/blob/master/docs/user/installation.md#recommended-setup</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>microk8s.kubectl create secret generic kubernetes-dashboard-certs --from-file<span class="token operator">=</span>./certs -n kube-system
</code></pre></div><h3 id="部署并访问"><a href="#部署并访问" aria-hidden="true" class="header-anchor">#</a> 部署并访问</h3> <ul><li>启用插件，<code>microk8s.enable dns ingress dashboard</code></li> <li>修改 dashboar dservice 中 spec-type 为 <code>NodePort</code>：<code>microk8s.kubectl edit svc kubernetes-dashboard -n kube-system</code></li> <li>使用命令<code>kubectl.exe describe svc kubernetes-dashboard -n kube-system</code>查看 NodePort，该值则为主机端口，访问 https+主机 ip+NodePort 即可</li> <li>登录之前需要获取 token，使用如下命令获取：</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>microk8s.kubectl -n kube-system describe secret <span class="token variable"><span class="token variable">$(</span>microk8s.kubectl -n kube-system get secret <span class="token operator">|</span> <span class="token function">grep</span> default-token <span class="token operator">|</span> <span class="token function">cut</span> -d <span class="token string">&quot; &quot;</span> -f1<span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">grep</span> token: <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$2</span>;}'</span>
</code></pre></div><ul><li>到这里就完成了 dashboard 的部署和访问了</li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <ul><li>以上就是本文关于 k8s 的单机版部署过程，适合新手即开发环境，建议多多动手敲一下命令，加快熟悉速度</li> <li>安装过程注意所有涉及的组件，以及相关名词，再结合文档 https://kubernetes.io/docs/home/ 排坑，这将是愉快的学习之旅</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xxred/xxred.github.io/edit/master/docs/k8s/microk8s.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/19/2019, 3:35:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/k8s/" class="prev router-link-active">
          /k8s/
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fe997443.js" defer></script><script src="/assets/js/2.bd7d8131.js" defer></script><script src="/assets/js/120.6b7a7008.js" defer></script>
  </body>
</html>
