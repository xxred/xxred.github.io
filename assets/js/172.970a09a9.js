(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{270:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"在-iis-上部署-python-web（flask）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在-iis-上部署-python-web（flask）","aria-hidden":"true"}},[t._v("#")]),t._v(" 在 iis 上部署 python web（Flask）")]),t._v(" "),s("ul",[s("li",[t._v("由于项目需要，要把 python 写的算法提供给其它项目使用，于是尝试部署为 web 项目，以服务形式提供给其它项目。由于服务器是 win 环境，其它项目也是部署在 iis，因此 python 项目也需要部署在 iis 上。")])]),t._v(" "),s("h2",{attrs:{id:"环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境","aria-hidden":"true"}},[t._v("#")]),t._v(" 环境")]),t._v(" "),s("ul",[s("li",[t._v("系统环境：windows server 2019")]),t._v(" "),s("li",[t._v("web 服务器：iis。打开服务网管理器->添加角色和功能->一直下一步到服务器角色->勾选 Web 服务器(IIS)->弹框后点添加功能->一直下一步直到角色服务->选择 Web 服务器-应用程序开发-CGI->下一步，然后安装")]),t._v(" "),s("li",[t._v("软件环境：Python 3.8。下载链接：https://www.python.org/downloads/ 。下载后管理员权限安装，执行"),s("code",[t._v("pip install wfastcgi")]),t._v("安装"),s("code",[t._v("wfastcgi")]),t._v("。安装后执行"),s("code",[t._v("wfastcgi-enable")]),t._v("启用"),s("code",[t._v("wfastcgi")]),t._v("，并记录输出的信息，包含了"),s("code",[t._v("python.exe")]),t._v("和"),s("code",[t._v("wfastcgi.py")]),t._v("的位置。参考 https://pypi.org/project/wfastcgi/")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("PS C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system3"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("2")]),t._v(">")]),t._v(" wfastcgi-enable\n已经在配置提交路径“MACHINE/WEBROOT/APPHOST”向“MACHINE/WEBROOT/APPHOST”的“system.webServer/fastCgi”节应用了配置更改\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c:\\users'),s("span",{pre:!0,attrs:{class:"token entity",title:"\\125"}},[t._v("\\125")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("ppdata\\local\\programs\\python\\python38-32\\python.exe|c:\\users"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\125"}},[t._v("\\125")]),t._v("04"),s("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v('ppdata\\local\\programs\\python\\python38-32\\lib\\site-packages\\wfastcgi.py"')]),t._v(" can now be used as a FastCGI script processor\n")])])]),s("h2",{attrs:{id:"flask-应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flask-应用","aria-hidden":"true"}},[t._v("#")]),t._v(" Flask 应用")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" flask "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Flask\napp"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Flask"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__name__"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("debug"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ul",[s("li",[t._v("将以上代码保存为"),s("code",[t._v("app.py")]),t._v("，接着创建"),s("code",[t._v("web.config")]),t._v(",填入以下内容。配置参考 https://pypi.org/project/wfastcgi/")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("system.webServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("handlers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Python FastCGI"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("verb")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("modules")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("FastCgiModule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("scriptProcessor")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("C:\\Python36\\python.exe|C:\\Python36\\Lib\\site-packages\\wfastcgi.py"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("resourceType")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Unspecified"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v("\n           "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("requireAccess")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("handlers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("system.webServer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("appSettings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 参数说明见 https://pypi.org/project/wfastcgi/ --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Required settings --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- my_app是模块名称，比如my_app.py，wsgi_app是其中属性，如果有括号就调用，否则当成属性。\n    上述应用中，模块名为app，Flask变量为app，此处应填“app.app”--\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("WSGI_HANDLER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("my_app.wsgi_app()"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("PYTHONPATH"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("C:\\MyApp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Optional settings --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('\x3c!--<add key="WSGI_LOG" value="C:\\Logs\\my_app.log" />\n    <add key="WSGI_RESTART_FILE_REGEX" value=".*((\\.py)|(\\.config))$" />\n    <add key="APPINSIGHTS_INSTRUMENTATIONKEY" value="__instrumentation_key__" />\n    <add key="DJANGO_SETTINGS_MODULE" value="my_app.settings" />\n    <add key="WSGI_PTVSD_SECRET" value="__secret_code__" />\n    <add key="WSGI_PTVSD_ADDRESS" value="ipaddress:port" />--\x3e')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("appSettings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("configuration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"创建站点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建站点","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建站点")]),t._v(" "),s("ul",[s("li",[t._v('完成以上步骤，创建站点，访问查看结果。如果运气好，应该能看到页面返回"Hello World!"')]),t._v(" "),s("li",[t._v("如果有问题请看下一节。")])]),t._v(" "),s("h2",{attrs:{id:"常见错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见错误","aria-hidden":"true"}},[t._v("#")]),t._v(" 常见错误")]),t._v(" "),s("h3",{attrs:{id:"http-错误-500-19-internal-server-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-错误-500-19-internal-server-error","aria-hidden":"true"}},[t._v("#")]),t._v(" HTTP 错误 500.19 - Internal Server Error")]),t._v(" "),s("ul",[s("li",[t._v("报错含有如下信息，"),s("code",[t._v('不能在此路径中使用此配置节。如果在父级别上锁定了该节，便会出现这种情况。锁定是默认设置的(overrideModeDefault="Deny")，或者是通过包含 overrideMode="Deny" 或旧有的 allowOverride="false" 的位置标记明确设置的。')]),t._v("。配置源哪个节点标红，下面的命令就设置解锁哪个节点。")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("C:"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Windows"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("system32"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("inetsrv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("appcmd unlock config -section:system.webServer/handlers\n")])])]),s("ul",[s("li",[t._v("出现此问题的原因是 IIS 的 web.config 管理机制，默认情况不允许修改。参考 https://www.cnblogs.com/jxxy2012nw/p/5629225.html")])]),t._v(" "),s("h3",{attrs:{id:"http-错误-500-0-internal-server-error"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http-错误-500-0-internal-server-error","aria-hidden":"true"}},[t._v("#")]),t._v(" HTTP 错误 500.0 - Internal Server Error")]),t._v(" "),s("ul",[s("li",[t._v("1、提示"),s("code",[t._v("发生未知 FastCGI 错误")]),t._v("，在"),s("code",[t._v("PTVS(Python Tools for Visual Studio )")]),t._v("项目中有"),s("a",{attrs:{href:"https://github.com/Microsoft/PTVS/issues/2024",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),s("OutboundLink")],1),t._v("提到，是权限问题")]),t._v(" "),s("li",[t._v("解决方式：选中网站对应的应用池->高级设置->进程模型的标识项由"),s("code",[t._v("ApplicationPoolIdentity")]),t._v("改为"),s("code",[t._v("LocalSystem")]),t._v("。")]),t._v(" "),s("li",[t._v("参考 https://blog.csdn.net/enter89/article/details/86231455")]),t._v(" "),s("li",[t._v("2、如果提示"),s("code",[t._v("无法在<fastCGI>应用程序配置中找到<handler> scriptProcessor")]),t._v("，则可能是 python 路径问题，比如说 python 安装路径过长、包含中文、包含空格。")]),t._v(" "),s("li",[t._v("解决方法是重装 python，避免上述路径问题，再重来即可。")])]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("ul",[s("li",[t._v("一开始将带有空格的路径设置为 python 路径就有坑了，尝试了多次，找了好多篇文章，才发现有一篇文章有截图，python 后面的参数是带双引号的，即"),s("code",[t._v('c:\\program files\\python\\python.exe|"c:\\program files\\python\\lib\\site-packages\\wfastcgi.py"')]),t._v("。然后在网站的处理程序映射中找到"),s("code",[t._v("FlaskFastCGI")]),t._v("，编辑加上双引号，点击确定的时候会提示是否创建 FastCGI 应用程序，点击是即可。然后在 iis 主页中 FastCGI 设置，删除最早的那个，只保留最后创建的那个即可。")]),t._v(" "),s("li",[t._v("最后整理测试，才发现最根本的问题，并且发现了权限的问题。")]),t._v(" "),s("li",[t._v("参考 https://segmentfault.com/a/1190000008909201")])])])},[],!1,null,null,null);a.default=e.exports}}]);