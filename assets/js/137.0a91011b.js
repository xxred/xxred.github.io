(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{212:function(s,t,a){"use strict";a.r(t);var e=a(0),r=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"ssh——windows-上使用（免密登陆及相关配置）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh——windows-上使用（免密登陆及相关配置）","aria-hidden":"true"}},[s._v("#")]),s._v(" ssh——windows 上使用（免密登陆及相关配置）")]),s._v(" "),a("ul",[a("li",[s._v("解释下用户目录，及用户工作目录，linux 系统登陆之后就处在工作目录，路径显示的是"),a("code",[s._v("~")]),s._v("符号，所以"),a("code",[s._v("~")]),s._v("代表的就是用户目录。windows 系统的用户目录位于"),a("code",[s._v("C:\\\\User\\\\用户名\\\\")]),s._v("。无特殊说明，下文"),a("code",[s._v("~")]),s._v("均指用户目录")]),s._v(" "),a("li",[s._v("现在 win10 默认命令行工具使用的是 powershell，执行命令"),a("code",[s._v("cd ~")]),s._v("即可切换到用户命令，"),a("code",[s._v("explorer.exe .")]),s._v("可在文件夹打开当前目录")])]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("ul",[a("li",[s._v("参考 https://code.visualstudio.com/docs/remote/troubleshooting#_installing-a-supported-ssh-client")])]),s._v(" "),a("h2",{attrs:{id:"win10-上的-ssh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#win10-上的-ssh","aria-hidden":"true"}},[s._v("#")]),s._v(" win10 上的 ssh")]),s._v(" "),a("ul",[a("li",[s._v("win10 1803 版本自带并启用")]),s._v(" "),a("li",[s._v("开启步骤：设置-应用-应用和功能-管理可选的功能-添加功能-OpenSSH 客户端")]),s._v(" "),a("li",[s._v("安装包下载 http://www.mls-software.com/opensshd.html")]),s._v(" "),a("li",[s._v("源码库 https://github.com/PowerShell/openssh-portable")])]),s._v(" "),a("h2",{attrs:{id:"删除-ssh-中旧的-rsa-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除-ssh-中旧的-rsa-key","aria-hidden":"true"}},[s._v("#")]),s._v(" 删除 ssh 中旧的 RSA key")]),s._v(" "),a("ul",[a("li",[a("code",[s._v('ssh-keygen -f "~/.ssh/known_hosts" -R 192.168.188.247')])]),s._v(" "),a("li",[s._v("或者端口不是 22 的情况，"),a("code",[s._v('ssh-keygen -f "~/.ssh/known_hosts" -R [192.168.188.247]:3645')])])]),s._v(" "),a("h2",{attrs:{id:"客户端配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置文件","aria-hidden":"true"}},[s._v("#")]),s._v(" 客户端配置文件")]),s._v(" "),a("ul",[a("li",[s._v("这里可以配置不同主机的信息，该文件位于"),a("code",[s._v("~/.ssh/config")])]),s._v(" "),a("li",[s._v("使用的时候可以直接使用名称，例如"),a("code",[s._v("ssh root@192.168.52.129")]),s._v("可用"),a("code",[s._v("ssh alpine")]),s._v("替代")])]),s._v(" "),a("div",{staticClass:"language-config extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Host alpine\n    HostName 192.168.52.129\n    User root\n    IdentityFile ~/.ssh/id_rsa-remote-ssh\n")])])]),a("ul",[a("li",[s._v("https://linux.die.net/man/5/ssh_config")])]),s._v(" "),a("h2",{attrs:{id:"使用公钥实现免密登陆"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用公钥实现免密登陆","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用公钥实现免密登陆")]),s._v(" "),a("ul",[a("li",[s._v("默认生成是在"),a("code",[s._v("~/.ssh/id_rsa")]),s._v("、"),a("code",[s._v("~/.ssh/id_rsa.pub")]),s._v("，pub 后缀为公钥")]),s._v(" "),a("li",[s._v("公钥为服务器持有，用于加密，私钥客户端持有，用于解密，证明你拥有私钥")]),s._v(" "),a("li",[s._v("登录时默认查找使用"),a("code",[s._v("~/.ssh/id_rsa")]),s._v("尝试免密登陆，如果是其他名称，使用参数"),a("code",[s._v("ssh -i id_rsa_name user@host")]),s._v("指定私钥")]),s._v(" "),a("li",[s._v("生成密钥对，这里不添加加密私钥的密码，所以一路回车")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssh-keygen -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" -f ~/.ssh/id_rsa-remote-ssh\n")])])]),a("ul",[a("li",[s._v("在~/.ssh/config 配置远程主机信息")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Host alpine\n    HostName "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".52.129\n    User root\n    IdentityFile ~/.ssh/id_rsa-remote-ssh\n")])])]),a("ul",[a("li",[s._v("将公钥文件传输到远程主机，此时远程主机还没有公钥，所以上面的配置文件虽然指定 IdentityFile，但仍然需要输入密码")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" id_rsa-remote-ssh.pub alpine:~/tmp.pub\n")])])]),a("ul",[a("li",[s._v("将本地公钥（id_rsa.pub 文件）的内容添加到 ssh 主机上相应的授权密钥文件中")])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" alpine "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat ~/tmp.pub >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys && rm -f ~/tmp.pub"')]),s._v("\n")])])]),a("ul",[a("li",[s._v("执行上述操作之后，使用命令"),a("code",[s._v("ssh alpine")]),s._v("就可以免密登陆，只需要输入私钥加密密码。私钥密码是创建密钥对的时候配置的，也可以缓存起来，参考"),a("code",[s._v("ssh-add")]),s._v("和"),a("code",[s._v("ssh-agent")]),s._v("。这里不设置私钥加密，所以免输入")]),s._v(" "),a("li",[s._v("将公钥放到各个主机，客户端只需要密钥，这样妈妈再也不用担心我记不住密码了")]),s._v(" "),a("li",[s._v("通俗易懂的博客 https://blog.csdn.net/sduuntion/article/details/26222715")]),s._v(" "),a("li",[s._v("参考资料 https://code.visualstudio.com/docs/remote/troubleshooting")]),s._v(" "),a("li",[s._v("公钥认证 https://www.ssh.com/ssh/public-key-authentication")])]),s._v(" "),a("h2",{attrs:{id:"服务端登录相关配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端登录相关配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务端登录相关配置")]),s._v(" "),a("ul",[a("li",[s._v("配置文件一般位于"),a("code",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),a("li",[s._v("将配置项前面的#号去掉，然后修改值")]),s._v(" "),a("li",[s._v("重启服务，"),a("code",[s._v("service ssh restart")]),s._v("或"),a("code",[s._v("service sshd restart")]),s._v("或"),a("code",[s._v("/etc/init.d/ssh restart")])])]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("PermitRootLogin "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许root登录")]),s._v("\nPermitEmptyPasswords no "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不允许空密码登录")]),s._v("\nPasswordAuthentication "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置是否使用口令验证")]),s._v("\nAuthorizedKeysFile .ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定授权文件")]),s._v("\n")])])]),a("h2",{attrs:{id:"调试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调试","aria-hidden":"true"}},[s._v("#")]),s._v(" 调试")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ssh -vvv host")])])]),s._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ul",[a("li",[s._v("一开始急于实现功能，没有仔细探究原理，找了很多使用公钥免密登陆教程，其中最大的问题竟然是私钥文件不是默认命名，登陆也没有指定私钥文件，不懂原理真的很吃亏")]),s._v(" "),a("li",[s._v("其次找到高质量教程很重要，通俗易懂又面面俱到，而不是一语带过。只要官方教程不是晦涩难懂，还是以官方文档为主")])])])},[],!1,null,null,null);t.default=r.exports}}]);