(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{276:function(e,a,t){"use strict";t.r(a);var r=t(0),n=Object(r.a)({},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"alpine-环境中安装-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alpine-环境中安装-docker","aria-hidden":"true"}},[e._v("#")]),e._v(" alpine 环境中安装 docker")]),e._v(" "),t("ul",[t("li",[e._v("alpine linux 是一个基于安全的轻量级 Linux 发行版，基于 musl libc 和 busybox。alpine linux 由于简单安全，非常适合 docker 的 linux 发行版，并且被 docker 官方所推荐用来取代 ubuntu。它不但非常小，仅有 5m 左右，而且经过优化可以在 RAM 中运行")]),e._v(" "),t("li",[e._v("既然这么省资源，那么本文就尝试在虚拟机中安装 alpine，然后安装 docker")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://wiki.alpinelinux.org/wiki/Main_Page",target:"_blank",rel:"noopener noreferrer"}},[e._v("官方文档"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载","aria-hidden":"true"}},[e._v("#")]),e._v(" 下载")]),e._v(" "),t("ul",[t("li",[e._v("alpinelinux"),t("code",[e._v("https://www.alpinelinux.org/downloads/")]),e._v("，这里选择"),t("code",[e._v("VIRTUAL")]),e._v("，它与标准版相似、瘦下来的内核、针对虚拟系统进行了优化。")]),e._v(" "),t("li",[t("a",{attrs:{href:"http://dl-cdn.alpinelinux.org/alpine/v3.9/releases/x86_64/alpine-virt-3.9.4-x86_64.iso",target:"_blank",rel:"noopener noreferrer"}},[e._v("下载地址链接"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("下载得到的文件是"),t("code",[e._v("alpine-virt-3.9.4-x86_64.iso")]),e._v("，大小 35m")])]),e._v(" "),t("h2",{attrs:{id:"vmware-中安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vmware-中安装","aria-hidden":"true"}},[e._v("#")]),e._v(" VMware 中安装")]),e._v(" "),t("ul",[t("li",[e._v("按道理 VirtualBox 也是一样的，VMware 的新建虚拟机的设置中，操作系统类型选择"),t("code",[e._v("Linux")]),e._v("，版本选择"),t("code",[e._v("其他Linux 4.x 或更高版本内核 64 位")])]),e._v(" "),t("li",[e._v("其他步骤按照提示来就行了，问题不大。新建完后启动虚拟机")])]),e._v(" "),t("h2",{attrs:{id:"设置-alpine"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置-alpine","aria-hidden":"true"}},[e._v("#")]),e._v(" 设置 alpine")]),e._v(" "),t("ul",[t("li",[e._v("启动之后进入安装步骤")]),e._v(" "),t("li",[e._v("具体步骤参考 https://wiki.alpinelinux.org/wiki/Install_to_disk")]),e._v(" "),t("li",[e._v("可参考博客："),t("a",{attrs:{href:"https://blog.csdn.net/csdn_duomaomao/article/details/76053229",target:"_blank",rel:"noopener noreferrer"}},[e._v("Alpine linux 硬盘安装"),t("OutboundLink")],1),e._v("、"),t("a",{attrs:{href:"https://blog.csdn.net/ochinchina_cn/article/details/58593271",target:"_blank",rel:"noopener noreferrer"}},[e._v("alpine linux docker 安装体验"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"apk-介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apk-介绍","aria-hidden":"true"}},[e._v("#")]),e._v(" apk 介绍")]),e._v(" "),t("ul",[t("li",[e._v("Alpine Linux 的软件包是经过数字签名的 tar.gz 存档，包含程序，配置文件和依赖关系元数据。它们具有扩展名.apk，通常称为“a-packs”。包存储在一个或多个存储库中。")]),e._v(" "),t("li",[e._v("相关文档，包含常用命令及介绍。https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://pkgs.alpinelinux.org/packages",target:"_blank",rel:"noopener noreferrer"}},[e._v("包搜索地址"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("有些包可能在社区的源才有，地址：http://dl-cdn.alpinelinux.org/alpine/latest-stable/community")])]),e._v(" "),t("h2",{attrs:{id:"安装-docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker","aria-hidden":"true"}},[e._v("#")]),e._v(" 安装 docker")]),e._v(" "),t("ul",[t("li",[e._v("Docker 包位于“社区”存储库中，因此如果 apk 添加失败且具有不可满足的约束，则需要编辑"),t("code",[e._v("/etc/apk/repositories")]),e._v("文件以添加（或取消注释）一行，如：http://dl-cdn.alpinelinux.org/alpine/latest-stable/community")]),e._v(" "),t("li",[e._v("更新索引存储库"),t("code",[e._v("apk update")])]),e._v(" "),t("li",[e._v("开始安装"),t("code",[e._v("apk add docker")])]),e._v(" "),t("li",[e._v("要在引导时启动 Docker 守护程序，请运行："),t("code",[e._v("rc-update add docker boot")])]),e._v(" "),t("li",[e._v("然后手动启动 Docker 守护程序，运行："),t("code",[e._v("service docker start")])]),e._v(" "),t("li",[e._v("参考"),t("a",{attrs:{href:"https://wiki.alpinelinux.org/wiki/Docker",target:"_blank",rel:"noopener noreferrer"}},[e._v("alpinelinux Docker"),t("OutboundLink")],1)])]),e._v(" "),t("h2",{attrs:{id:"运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行","aria-hidden":"true"}},[e._v("#")]),e._v(" 运行")]),e._v(" "),t("ul",[t("li",[e._v("启动"),t("code",[e._v("service docker start")])]),e._v(" "),t("li",[t("code",[e._v("docker run hello-word")])])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("localhost:/etc/docker"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# docker run hello-world")]),e._v("\nUnable to "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("find")]),e._v(" image "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'hello-world:latest'")]),e._v(" locally\nlatest: Pulling from library/hello-world\n1b930d010525: Pull complete\nDigest: sha256:0e11c388b664df8a27a901dce21eb89f11d8292f7fca1b3e3c4321bf7897bffe\nStatus: Downloaded newer image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" hello-world:latest\n\nHello from Docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(". The Docker client contacted the Docker daemon.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v(". The Docker daemon pulled the "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hello-world"')]),e._v(" image from the Docker Hub.\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v(". The Docker daemon created a new container from that image "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("which")]),e._v(" runs the\n    executable that produces the output you are currently reading.\n "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),e._v(". The Docker daemon streamed that output to the Docker client, "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("which")]),e._v(" sent it\n    to your terminal.\n\nTo try something "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("more")]),e._v(" ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v("\n\nShare images, automate workflows, and "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("more")]),e._v(" with a "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("free")]),e._v(" Docker ID:\n https://hub.docker.com/\n\nFor "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("more")]),e._v(" examples and ideas, visit:\n https://docs.docker.com/get-started/\n")])])]),t("h2",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题","aria-hidden":"true"}},[e._v("#")]),e._v(" 问题")]),e._v(" "),t("ul",[t("li",[e._v("上面安装完 docker 之后，使用命令"),t("code",[e._v("docker -v")]),e._v("可查看版本，但是容器相关命令出错")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("localhost:~"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# docker ps")]),e._v("\nCannot connect to the Docker daemon at unix:///var/rundocker.sock. Is   the docker daemon running?\n")])])]),t("ul",[t("li",[e._v("通过命令"),t("code",[e._v("service docker start")]),e._v("也启动 docker，`/var/run/docker.sock 也确实存在。")]),e._v(" "),t("li",[e._v("折腾一番之后，查看日志"),t("code",[e._v("cat ./var/log/docker.log")]),e._v("，得到关键信息"),t("code",[e._v("Error starting daemon: Devices cgroup isn't mounted")]),e._v("。")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" ./var/log/docker.log\n")])])]),t("ul",[t("li",[e._v("最后看了官方文档得以解决，https://wiki.alpinelinux.org/wiki/Docker")]),e._v(" "),t("li",[e._v("关键点还是"),t("code",[e._v("cgroup filesystem")]),e._v("的问题，"),t("code",[e._v("cgroup")]),e._v("是什么请自行查询")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("localhost:/etc/docker"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# rc-update add docker boot")]),e._v("\n * "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" docker added to runlevel boot\nlocalhost:/etc/docker"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# service docker start")]),e._v("\n * Mounting cgroup filesystem "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n * Starting docker "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v(".\n")])])]),t("ul",[t("li",[e._v("所以整个问题的根源是"),t("code",[e._v("cgroup filesystem")]),e._v("没有挂载，在执行"),t("code",[e._v("rc-update add docker boot")]),e._v("后在启动就好了")])]),e._v(" "),t("h2",{attrs:{id:"其他使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他使用","aria-hidden":"true"}},[e._v("#")]),e._v(" 其他使用")]),e._v(" "),t("h3",{attrs:{id:"执行脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行脚本","aria-hidden":"true"}},[e._v("#")]),e._v(" 执行脚本")]),e._v(" "),t("ul",[t("li",[e._v("sh 执行/bin/busybox，执行脚本不支持括号方式的数组，因此需要 bash，其他解决办法暂不知晓")]),e._v(" "),t("li",[e._v("执行查看"),t("code",[e._v("ls -l /bin/*sh")]),e._v("，没有 bash 的话，执行"),t("code",[e._v("apk add bash")]),e._v("安装")])]),e._v(" "),t("h3",{attrs:{id:"替换镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#替换镜像","aria-hidden":"true"}},[e._v("#")]),e._v(" 替换镜像")]),e._v(" "),t("ul",[t("li",[e._v("在终端输入以下命令以替换 TUNA 镜像源： "),t("code",[e._v("sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories")])])]),e._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),t("ul",[t("li",[e._v("多次总结，使用一款产品，第一件事就是找到文档，文档实在晦涩难懂的情况，那么可能有翻译版或者国内版，毕竟官方的才是最权威的")]),e._v(" "),t("li",[e._v("其次是每个人用起来遇到的环境可能不一样，遇到的问题也就不一样，但所有的解决思路中，查看日志这一条是我觉得始终应该第一考虑的，它很明白告诉你，出错了，出了什么错，可能还有出错的具体位置以及建议解决方案")]),e._v(" "),t("li",[e._v("end")])])])},[],!1,null,null,null);a.default=n.exports}}]);