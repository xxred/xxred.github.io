(window.webpackJsonp=window.webpackJsonp||[]).push([[115],{222:function(s,a,t){"use strict";t.r(a);var e=t(0),r=Object(e.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用-microk8s-安装单节点-k8s-集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-microk8s-安装单节点-k8s-集群","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用 microk8s 安装单节点 k8s 集群")]),s._v(" "),t("ul",[t("li",[s._v("microk8s 适用于 42 种 Linux 版本的单一 k8s 包。专为开发人员而设计，非常适合边缘，物联网和电器。由于总所周知的网络原因，默认的镜像包下载地址无法访问，本文可作为第一次安装的人的一份参考")])]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("ul",[t("li",[s._v("安装环境为 ubuntu18.04，此系统已内置 snap，可以直接通过 snap 安装")]),s._v(" "),t("li",[s._v("安装命令"),t("code",[s._v("sudo snap install microk8s --classic")])]),s._v(" "),t("li",[s._v("或者选择其他系列版本，如"),t("code",[s._v("v1.14")]),s._v("。"),t("code",[s._v("v1.14")]),s._v("版本开始，容器运行时默认改为"),t("a",{attrs:{href:"https://containerd.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("containerd"),t("OutboundLink")],1),s._v(" 。命令"),t("code",[s._v("snap install microk8s --classic --channel=1.14/stable")])]),s._v(" "),t("li",[s._v("这里我选择安装"),t("code",[s._v("v1.15")]),s._v("系列的，"),t("code",[s._v("snap install microk8s --classic --channel=1.15/stable")])]),s._v(" "),t("li",[s._v("安装完成，使用命令"),t("code",[s._v("microk8s.status")]),s._v("查看"),t("code",[s._v("microk8s")]),s._v("是否可用。安装完成将有如下输出：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("microk8s is running\naddons:\nknative: disabled\njaeger: disabled\nfluentd: disabled\ngpu: disabled\ncilium: disabled\nstorage: disabled\nregistry: disabled\nrbac: disabled\ningress: disabled\ndns: disabled\nmetrics-server: disabled\nlinkerd: disabled\nprometheus: disabled\nistio: disabled\ndashboard: disabled\n")])])]),t("ul",[t("li",[s._v("为了避免与已安装的 kubectl 发生冲突并避免覆盖任何现有的 Kubernetes 配置文件，MicroK8s 添加了一个 microk8s.kubectl 命令，配置为专门访问新的 MicroK8s 安装。在使用 kubectl 时，确保前缀 kubectl 用 microk8s，如：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("microk8s.kubectl get nodes\nmicrok8s.kubectl get services\n")])])]),t("ul",[t("li",[s._v("如果 kubectl 没有安装过，则可以别名 microk8s.kubectl 来 kubectl 使用下面的命令"),t("code",[s._v("snap alias microk8s.kubectl kubectl")]),s._v("，恢复命令"),t("code",[s._v("snap unalias kubectl")])]),s._v(" "),t("li",[s._v("如果已经安装了 kubectl，可以用下面的命令覆盖配置文件：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("microk8s.kubectl config view --raw "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])])]),t("h2",{attrs:{id:"问题排查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题排查","aria-hidden":"true"}},[s._v("#")]),s._v(" 问题排查")]),s._v(" "),t("ul",[t("li",[s._v("安装过程通过命令"),t("code",[s._v("microk8s.inspect")]),s._v("排查，通过命令"),t("code",[s._v("journalctl -u snap.microk8s.<daemon>.service")]),s._v("查看有问题的服务的日志。所有服务"),t("code",[s._v("running")]),s._v("以及没有"),t("code",[s._v("WARNING")]),s._v("就是安装成功了。以下是一个例子，需要配置防火墙：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Inspecting services\n  Service snap.microk8s.daemon-containerd is running\n  Service snap.microk8s.daemon-apiserver is running\n  Service snap.microk8s.daemon-proxy is running\n  Service snap.microk8s.daemon-kubelet is running\n  Service snap.microk8s.daemon-scheduler is running\n  Service snap.microk8s.daemon-controller-manager is running\n  Service snap.microk8s.daemon-etcd is running\n  Copy "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" arguments to the final report tarball\nInspecting AppArmor configuration\nGathering system information\n  Copy processes list to the final report tarball\n  Copy snap list to the final report tarball\n  Copy VM name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("or none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to the final report tarball\n  Copy disk usage information to the final report tarball\n  Copy memory usage information to the final report tarball\n  Copy server "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uptime")]),s._v(" to the final report tarball\n  Copy current linux distribution to the final report tarball\n  Copy openSSL information to the final report tarball\n  Copy network configuration to the final report tarball\nInspecting kubernetes cluster\n  Inspect kubernetes cluster\n\n WARNING:  IPtables FORWARD policy is DROP. Consider enabling traffic forwarding with: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" iptables -P FORWARD ACCEPT\nThe change can be made persistent with: "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iptables-persistent\nBuilding the report tarball\n  Report tarball is at /var/snap/microk8s/826/inspection-report-20190906_092912.tar.gz\n")])])]),t("ul",[t("li",[s._v("通过命令解决："),t("code",[s._v("sudo iptables -P FORWARD ACCEPT")]),s._v("，利用"),t("code",[s._v("ufw")]),s._v("持久化这些配置"),t("code",[s._v("sudo ufw default allow routed")])])]),s._v(" "),t("h2",{attrs:{id:"下载镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 下载镜像")]),s._v(" "),t("h3",{attrs:{id:"修改-sandbox-image"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改-sandbox-image","aria-hidden":"true"}},[s._v("#")]),s._v(" 修改 sandbox_image")]),s._v(" "),t("ul",[t("li",[s._v("不修改也行，使用下面加载镜像的脚本，也能得到 "),t("code",[s._v("k8s.gcr.io/pause:3.1")])]),s._v(" "),t("li",[s._v("编辑"),t("code",[s._v("/var/snap/microk8s/current/args/containerd.template.toml")]),s._v("文件，sandbox_image 处修改为：")])]),s._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins.cri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("sandbox_image")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1"')]),s._v("\n")])])]),t("h3",{attrs:{id:"更换镜像源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更换镜像源","aria-hidden":"true"}},[s._v("#")]),s._v(" 更换镜像源")]),s._v(" "),t("ul",[t("li",[s._v("编辑"),t("code",[s._v("/var/snap/microk8s/current/args/containerd.template.toml")]),s._v("文件，mirrors 处修改为：")])]),s._v(" "),t("div",{staticClass:"language-toml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins.cri")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins.cri.registry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("plugins.cri.registry.mirrors")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v('plugins.cri.registry.mirrors."docker.io"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("endpoint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v('plugins.cri.registry.mirrors."local.insecure-registry.io"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("endpoint")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:32000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("修改完以上配置之后重启："),t("code",[s._v("microk8s.stop && microk8s.start")])]),s._v(" "),t("li",[s._v("默认镜像下载地址是"),t("code",[s._v("k8s.gcr.io")]),s._v("，我们通过镜像下载到本地，再修改标签的方式解决这个网络问题")]),s._v(" "),t("li",[s._v("命令如下：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("images")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\nk8s.gcr.io/pause:3.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google-containers/pause:3.1\ngcr.io/google_containers/defaultbackend-amd64:1.4"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gcr.azk8s.cn/google-containers/defaultbackend-amd64:1.4\nk8s.gcr.io/kubernetes-dashboard-amd64:v1.10.1"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.1\nk8s.gcr.io/heapster-influxdb-amd64:v1.3.3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-influxdb-amd64:v1.3.3\nk8s.gcr.io/heapster-amd64:v1.5.2"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-amd64:v1.5.2\nk8s.gcr.io/heapster-grafana-amd64:v4.4.3"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers/heapster-grafana-amd64:v4.4.3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OIFS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$IFS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存旧值")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("image")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${images"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("IFS")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'='")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$image")]),s._v("\n    docker pull "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n    docker tag  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n    docker rmi  "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n    docker save "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".tar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" microk8s.ctr -n k8s.io  i "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".tar "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".tar\n    "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("IFS")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OIFS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 还原旧值")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),t("h3",{attrs:{id:"查看需要的镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看需要的镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 查看需要的镜像")]),s._v(" "),t("ul",[t("li",[s._v("通过命令 "),t("code",[s._v("microk8s.kubectl get all -A")]),s._v("查看名字是"),t("code",[s._v("pod/")]),s._v("开头的，找到 pod 对应名称，然后使用命令"),t("code",[s._v("microk8s.kubectl describe pod kubernetes-dashboard-7d75c474bb-44789 -n kube-system")]),s._v("查看输出最后的事件，事件描述了需要拉取哪个镜像。当启用某个插件的时候，因网络问题无法启动，可通过此方法找到所需镜像，再根据上述命令从别的地方拉取")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("  NAMESPACE NAME READY STATUS RESTARTS AGE\n  kube-system pod/kubernetes-dashboard-7d75c474bb-44789 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 4d\n")])])]),t("h2",{attrs:{id:"dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dashboard","aria-hidden":"true"}},[s._v("#")]),s._v(" dashboard")]),s._v(" "),t("ul",[t("li",[s._v("Kubernetes Dashboard 是 Kubernetes 集群的基于 Web 的通用 UI。它允许用户管理在群集中运行的应用程序并对其进行故障排除，以及管理群集本身")]),s._v(" "),t("li",[s._v("默认情况下，dashboard 部署完会自动生成一个证书，但是这个证书貌似不是很好使，一般浏览器不放行，只有火狐浏览器能忽略风险继续访问，因此需要用自己的证书替换，只需要在启用 dashboard 前，在与 dashboard 相同命名空间下创建名为\nkubernetes-dashboard-certs 的密钥")])]),s._v(" "),t("h3",{attrs:{id:"生成证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成证书","aria-hidden":"true"}},[s._v("#")]),s._v(" 生成证书")]),s._v(" "),t("ul",[t("li",[s._v("可以用"),t("a",{attrs:{href:"https://letsencrypt.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Let's Encrypt"),t("OutboundLink")],1),s._v("生成证书，或者使用自签名证书，参考 https://github.com/kubernetes/dashboard/blob/master/docs/user/certificate-management.md")]),s._v(" "),t("li",[s._v("以下使用 openssl 生成证书，当提示输入密码时直接回车跳过即可")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成dashboard.key私钥和dashboard.csr文件")]),s._v("\nopenssl genrsa -des3 -passout pass:123456 -out dashboard.pass.key "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\nopenssl rsa -passin pass:123456 -in dashboard.pass.key -out dashboard.key\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" dashboard.pass.key\nopenssl req -new -key dashboard.key -out dashboard.csr\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSL证书")]),s._v("\nopenssl x509 -req -sha256 -days "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -in dashboard.csr -signkey dashboard.key -out dashboard.crt\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" dashboard.csr\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" certs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" dashboard.key dashboard.crt certs\n")])])]),t("h3",{attrs:{id:"创建密钥"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建密钥","aria-hidden":"true"}},[s._v("#")]),s._v(" 创建密钥")]),s._v(" "),t("ul",[t("li",[s._v("自定义证书必须存储在与 Kubernetes Dashboard 相同的命名空间中的 kubernetes-dashboard-certs 密钥中。将 dashboard.crt 和 dashboard.key 文件存储在 certs 目录下，然后用这些文件的内容创建密钥")]),s._v(" "),t("li",[s._v("参考 https://github.com/kubernetes/dashboard/blob/master/docs/user/installation.md#recommended-setup")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("microk8s.kubectl create secret generic kubernetes-dashboard-certs --from-file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./certs -n kube-system\n")])])]),t("h3",{attrs:{id:"部署并访问"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署并访问","aria-hidden":"true"}},[s._v("#")]),s._v(" 部署并访问")]),s._v(" "),t("ul",[t("li",[s._v("启用插件，"),t("code",[s._v("microk8s.enable dns ingress dashboard")])]),s._v(" "),t("li",[s._v("修改 dashboar dservice 中 spec-type 为 "),t("code",[s._v("NodePort")]),s._v("："),t("code",[s._v("microk8s.kubectl edit svc kubernetes-dashboard -n kube-system")])]),s._v(" "),t("li",[s._v("使用命令"),t("code",[s._v("kubectl.exe describe svc kubernetes-dashboard -n kube-system")]),s._v("查看 NodePort，该值则为主机端口，访问 https+主机 ip+NodePort 即可")]),s._v(" "),t("li",[s._v("登录之前需要获取 token，使用如下命令获取：")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("microk8s.kubectl -n kube-system describe secret "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("microk8s.kubectl -n kube-system get secret "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" default-token "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cut")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" "')]),s._v(" -f1"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" token: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v(";}'")]),s._v("\n")])])]),t("ul",[t("li",[s._v("到这里就完成了 dashboard 的部署和访问了")])]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("ul",[t("li",[s._v("以上就是本文关于 k8s 的单机版部署过程，适合新手即开发环境，建议多多动手敲一下命令，加快熟悉速度")]),s._v(" "),t("li",[s._v("安装过程注意所有涉及的组件，以及相关名词，再结合文档 https://kubernetes.io/docs/home/ 排坑，这将是愉快的学习之旅")])])])},[],!1,null,null,null);a.default=r.exports}}]);