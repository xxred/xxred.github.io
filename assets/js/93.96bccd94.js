(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{296:function(a,t,r){"use strict";r.r(t);var e=r(0),v=Object(e.a)({},function(){var a=this,t=a.$createElement,r=a._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"文件上传"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#文件上传","aria-hidden":"true"}},[a._v("#")]),a._v(" 文件上传")]),a._v(" "),r("ul",[r("li",[a._v("基于百度文件上传组件封装的文件上传组件，包括断点续传、大文件上传等功能")])]),a._v(" "),r("h2",{attrs:{id:"大文件上传"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#大文件上传","aria-hidden":"true"}},[a._v("#")]),a._v(" 大文件上传")]),a._v(" "),r("ul",[r("li",[a._v("大文件上传如果一次性上传，可能会超出服务器缓存区设置的大小。或者对接的是文件服务，超过传输大小限制。")]),a._v(" "),r("li",[a._v("解决办法就是将大文件分片，分片传输到服务器后合并。")])]),a._v(" "),r("h2",{attrs:{id:"断点续传"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#断点续传","aria-hidden":"true"}},[a._v("#")]),a._v(" 断点续传")]),a._v(" "),r("ul",[r("li",[a._v("断点续传实际上是一个文件分片之后，之前传来了一部分，续传的时候继续传剩下的分片")])]),a._v(" "),r("h2",{attrs:{id:"上传过程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传过程","aria-hidden":"true"}},[a._v("#")]),a._v(" 上传过程")]),a._v(" "),r("h3",{attrs:{id:"上传前"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传前","aria-hidden":"true"}},[a._v("#")]),a._v(" 上传前")]),a._v(" "),r("ul",[r("li",[a._v("文件上传之前先查询文件是否已经上传，如已上传返回文件信息，否则开始上传")]),a._v(" "),r("li",[a._v("开始上传前，先计算文件大小，通过判断某个文件大小是否达到分片大小，用变量isChunk标记是否开启了分片上传，该变量随文件一起上传到后台。")]),a._v(" "),r("li",[a._v("如果开启分片上传，同时将文件md5值，分片md5值以前传到后台。上传分片前同样先查询分片是否已上传，已经上传的分片则不再上传。")])]),a._v(" "),r("h3",{attrs:{id:"上传中"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传中","aria-hidden":"true"}},[a._v("#")]),a._v(" 上传中")]),a._v(" "),r("h4",{attrs:{id:"文件保存"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#文件保存","aria-hidden":"true"}},[a._v("#")]),a._v(" 文件保存")]),a._v(" "),r("ul",[r("li",[a._v("每次保存文件分片，除了文件基本信息，还会包括两个参数：chunk、chunks。即当前分片序号和总分片数。")]),a._v(" "),r("li",[a._v("后台根据isChunk决定是执行保存文件还是保存分片操作。")]),a._v(" "),r("li",[a._v("缓存文件夹内每个文件对应文件夹以文件md5值命名，保存所有缓存的分片，通过判断已保存的分片实现断点续传。")])]),a._v(" "),r("h4",{attrs:{id:"上传进度"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传进度","aria-hidden":"true"}},[a._v("#")]),a._v(" 上传进度")]),a._v(" "),r("ul",[r("li",[a._v("提示已上传比例")])]),a._v(" "),r("h3",{attrs:{id:"上传结束"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传结束","aria-hidden":"true"}},[a._v("#")]),a._v(" 上传结束")]),a._v(" "),r("ul",[r("li",[a._v("不开启分片上传，直接保存文件，一步到位。")]),a._v(" "),r("li",[a._v("开启分片上传，在全部分片上传之后，再次请求以合并文件。")]),a._v(" "),r("li",[a._v("合并后再次校验md5，校验失败要求重新上传文件。校验成功则保存文件成功，删除所有分片文件。")])]),a._v(" "),r("h2",{attrs:{id:"实现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实现","aria-hidden":"true"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),r("h3",{attrs:{id:"服务端"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#服务端","aria-hidden":"true"}},[a._v("#")]),a._v(" 服务端")]),a._v(" "),r("h4",{attrs:{id:"保存文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#保存文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 保存文件")]),a._v(" "),r("ul",[r("li",[a._v("首先实现基本的文件保存，用于小文件，比如图片之类的。")]),a._v(" "),r("li",[a._v("实现一个方法，接收文件流，传入文件基本信息，可保存整个文件或者分片文件。")]),a._v(" "),r("li",[a._v("保存分片，先将分片存为后缀为"),r("code",[a._v("parttmp")]),a._v("文件，完成之后再将"),r("code",[a._v("parttmp")]),a._v("改为"),r("code",[a._v("part")]),a._v("，以确保"),r("code",[a._v("part")]),a._v("是个完全的分片，避免"),r("code",[a._v("parttmp")]),a._v("未完成保存就被中断。保存的文件夹以文件md5值命名。")])])])},[],!1,null,null,null);t.default=v.exports}}]);