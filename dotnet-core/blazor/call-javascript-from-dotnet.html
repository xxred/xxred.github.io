<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从 ASP .NET Core Blazor 中的 .NET 方法调用 JavaScript 函数 | xxred&#39;s notes</title>
    <meta name="description" content="记录学习过程，收集学习资源">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3ab1ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/logo.jpg">
  <meta name="msapplication-TileImage" content="/logo.jpg">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.5203916d.css" as="style"><link rel="preload" href="/assets/js/app.7ecefee6.js" as="script"><link rel="preload" href="/assets/js/2.bd7d8131.js" as="script"><link rel="preload" href="/assets/js/83.8607788b.js" as="script"><link rel="prefetch" href="/assets/js/10.943b3145.js"><link rel="prefetch" href="/assets/js/100.5d70c260.js"><link rel="prefetch" href="/assets/js/101.9ca1cf01.js"><link rel="prefetch" href="/assets/js/102.8b545f05.js"><link rel="prefetch" href="/assets/js/103.3b68de31.js"><link rel="prefetch" href="/assets/js/104.5f97e181.js"><link rel="prefetch" href="/assets/js/105.95519593.js"><link rel="prefetch" href="/assets/js/106.e167220a.js"><link rel="prefetch" href="/assets/js/107.d9470c3f.js"><link rel="prefetch" href="/assets/js/108.49dd8cd0.js"><link rel="prefetch" href="/assets/js/109.1abadad5.js"><link rel="prefetch" href="/assets/js/11.43f9ecbc.js"><link rel="prefetch" href="/assets/js/110.f49e7b9a.js"><link rel="prefetch" href="/assets/js/111.aa532615.js"><link rel="prefetch" href="/assets/js/112.2ba433fc.js"><link rel="prefetch" href="/assets/js/113.4657fc50.js"><link rel="prefetch" href="/assets/js/114.0ef5404f.js"><link rel="prefetch" href="/assets/js/115.10f29d9e.js"><link rel="prefetch" href="/assets/js/116.f294b8ec.js"><link rel="prefetch" href="/assets/js/117.9b4e01ab.js"><link rel="prefetch" href="/assets/js/118.67dfa1e0.js"><link rel="prefetch" href="/assets/js/119.3a26bad7.js"><link rel="prefetch" href="/assets/js/12.ed3af407.js"><link rel="prefetch" href="/assets/js/120.3df8ea3d.js"><link rel="prefetch" href="/assets/js/121.d51b7f8f.js"><link rel="prefetch" href="/assets/js/122.0f36202f.js"><link rel="prefetch" href="/assets/js/123.67dafd07.js"><link rel="prefetch" href="/assets/js/124.8cb3ba2d.js"><link rel="prefetch" href="/assets/js/125.8d0e8074.js"><link rel="prefetch" href="/assets/js/126.ad9c05b7.js"><link rel="prefetch" href="/assets/js/127.df8f422b.js"><link rel="prefetch" href="/assets/js/128.b7a5982d.js"><link rel="prefetch" href="/assets/js/129.3240f125.js"><link rel="prefetch" href="/assets/js/13.d7e6a638.js"><link rel="prefetch" href="/assets/js/130.0f3264cf.js"><link rel="prefetch" href="/assets/js/131.bbafd254.js"><link rel="prefetch" href="/assets/js/132.040f5265.js"><link rel="prefetch" href="/assets/js/133.eabb79c6.js"><link rel="prefetch" href="/assets/js/134.c4f50870.js"><link rel="prefetch" href="/assets/js/135.9d650d11.js"><link rel="prefetch" href="/assets/js/136.3544c406.js"><link rel="prefetch" href="/assets/js/137.1c30d247.js"><link rel="prefetch" href="/assets/js/138.eace14c8.js"><link rel="prefetch" href="/assets/js/139.683a40d9.js"><link rel="prefetch" href="/assets/js/14.7854aad0.js"><link rel="prefetch" href="/assets/js/140.18502fd3.js"><link rel="prefetch" href="/assets/js/141.1c43d1a7.js"><link rel="prefetch" href="/assets/js/142.4797e969.js"><link rel="prefetch" href="/assets/js/143.84ef8a24.js"><link rel="prefetch" href="/assets/js/144.4abba511.js"><link rel="prefetch" href="/assets/js/145.eff17e51.js"><link rel="prefetch" href="/assets/js/146.eef3e49a.js"><link rel="prefetch" href="/assets/js/147.a19d18bb.js"><link rel="prefetch" href="/assets/js/148.26407a7b.js"><link rel="prefetch" href="/assets/js/149.a632de03.js"><link rel="prefetch" href="/assets/js/15.d28e4da1.js"><link rel="prefetch" href="/assets/js/150.4598d28e.js"><link rel="prefetch" href="/assets/js/151.fcf1153f.js"><link rel="prefetch" href="/assets/js/152.6d579ab2.js"><link rel="prefetch" href="/assets/js/153.9e045056.js"><link rel="prefetch" href="/assets/js/154.2b246d37.js"><link rel="prefetch" href="/assets/js/155.7808f597.js"><link rel="prefetch" href="/assets/js/156.30c2b0f4.js"><link rel="prefetch" href="/assets/js/157.72025167.js"><link rel="prefetch" href="/assets/js/158.f9e30263.js"><link rel="prefetch" href="/assets/js/159.197ec311.js"><link rel="prefetch" href="/assets/js/16.f40ef52d.js"><link rel="prefetch" href="/assets/js/160.ddd83438.js"><link rel="prefetch" href="/assets/js/161.e046bc1a.js"><link rel="prefetch" href="/assets/js/162.b92702b7.js"><link rel="prefetch" href="/assets/js/163.512c8110.js"><link rel="prefetch" href="/assets/js/164.39232793.js"><link rel="prefetch" href="/assets/js/165.3666d452.js"><link rel="prefetch" href="/assets/js/166.5c95db03.js"><link rel="prefetch" href="/assets/js/167.389d8050.js"><link rel="prefetch" href="/assets/js/168.dc9f592a.js"><link rel="prefetch" href="/assets/js/169.896f3896.js"><link rel="prefetch" href="/assets/js/17.7f1fa5a0.js"><link rel="prefetch" href="/assets/js/170.d1ce556a.js"><link rel="prefetch" href="/assets/js/171.7c39bd51.js"><link rel="prefetch" href="/assets/js/172.aabdc0d1.js"><link rel="prefetch" href="/assets/js/18.1c44a238.js"><link rel="prefetch" href="/assets/js/19.62e2ce14.js"><link rel="prefetch" href="/assets/js/20.ca9aee5b.js"><link rel="prefetch" href="/assets/js/21.1a3be06b.js"><link rel="prefetch" href="/assets/js/22.552973a4.js"><link rel="prefetch" href="/assets/js/23.6e5be32e.js"><link rel="prefetch" href="/assets/js/24.5ebb01a6.js"><link rel="prefetch" href="/assets/js/25.66559830.js"><link rel="prefetch" href="/assets/js/26.e9ac56fb.js"><link rel="prefetch" href="/assets/js/27.db42be3b.js"><link rel="prefetch" href="/assets/js/28.b8636026.js"><link rel="prefetch" href="/assets/js/29.8de28d9f.js"><link rel="prefetch" href="/assets/js/3.f12ab206.js"><link rel="prefetch" href="/assets/js/30.b804c7f2.js"><link rel="prefetch" href="/assets/js/31.cc10d7e4.js"><link rel="prefetch" href="/assets/js/32.9294f3e9.js"><link rel="prefetch" href="/assets/js/33.25df08f1.js"><link rel="prefetch" href="/assets/js/34.8bea29cb.js"><link rel="prefetch" href="/assets/js/35.2e80ddd9.js"><link rel="prefetch" href="/assets/js/36.c2c119cb.js"><link rel="prefetch" href="/assets/js/37.82925abf.js"><link rel="prefetch" href="/assets/js/38.a31e20c5.js"><link rel="prefetch" href="/assets/js/39.24c4d8bf.js"><link rel="prefetch" href="/assets/js/4.6c3a763f.js"><link rel="prefetch" href="/assets/js/40.37178ef5.js"><link rel="prefetch" href="/assets/js/41.6af4b067.js"><link rel="prefetch" href="/assets/js/42.9bf5692d.js"><link rel="prefetch" href="/assets/js/43.30326c26.js"><link rel="prefetch" href="/assets/js/44.2637f324.js"><link rel="prefetch" href="/assets/js/45.eeb39f20.js"><link rel="prefetch" href="/assets/js/46.60d0de74.js"><link rel="prefetch" href="/assets/js/47.0f65d134.js"><link rel="prefetch" href="/assets/js/48.4ea83c2a.js"><link rel="prefetch" href="/assets/js/49.8ace5b41.js"><link rel="prefetch" href="/assets/js/5.2fbf22e6.js"><link rel="prefetch" href="/assets/js/50.740ebbc7.js"><link rel="prefetch" href="/assets/js/51.4951fad1.js"><link rel="prefetch" href="/assets/js/52.675aa6f1.js"><link rel="prefetch" href="/assets/js/53.847fd5b8.js"><link rel="prefetch" href="/assets/js/54.a68863aa.js"><link rel="prefetch" href="/assets/js/55.139d2339.js"><link rel="prefetch" href="/assets/js/56.18d48049.js"><link rel="prefetch" href="/assets/js/57.a0ec922a.js"><link rel="prefetch" href="/assets/js/58.f0084f7e.js"><link rel="prefetch" href="/assets/js/59.168abe51.js"><link rel="prefetch" href="/assets/js/6.c61c395f.js"><link rel="prefetch" href="/assets/js/60.f50a60f0.js"><link rel="prefetch" href="/assets/js/61.bf908564.js"><link rel="prefetch" href="/assets/js/62.99045590.js"><link rel="prefetch" href="/assets/js/63.b7f66e34.js"><link rel="prefetch" href="/assets/js/64.5700f207.js"><link rel="prefetch" href="/assets/js/65.f5fa4789.js"><link rel="prefetch" href="/assets/js/66.edff1d82.js"><link rel="prefetch" href="/assets/js/67.586a2015.js"><link rel="prefetch" href="/assets/js/68.8dfc194f.js"><link rel="prefetch" href="/assets/js/69.0e48e6cd.js"><link rel="prefetch" href="/assets/js/7.824cb09a.js"><link rel="prefetch" href="/assets/js/70.4629acad.js"><link rel="prefetch" href="/assets/js/71.2cc71ec3.js"><link rel="prefetch" href="/assets/js/72.8b316caf.js"><link rel="prefetch" href="/assets/js/73.c1ca81c6.js"><link rel="prefetch" href="/assets/js/74.3c4c094e.js"><link rel="prefetch" href="/assets/js/75.435d18fc.js"><link rel="prefetch" href="/assets/js/76.101bac4e.js"><link rel="prefetch" href="/assets/js/77.93889cac.js"><link rel="prefetch" href="/assets/js/78.031d00ce.js"><link rel="prefetch" href="/assets/js/79.908287ed.js"><link rel="prefetch" href="/assets/js/8.d2b4ba16.js"><link rel="prefetch" href="/assets/js/80.a41d9776.js"><link rel="prefetch" href="/assets/js/81.54767fa8.js"><link rel="prefetch" href="/assets/js/82.ce61e631.js"><link rel="prefetch" href="/assets/js/84.a9520670.js"><link rel="prefetch" href="/assets/js/85.3cb5bc07.js"><link rel="prefetch" href="/assets/js/86.99b7e261.js"><link rel="prefetch" href="/assets/js/87.0b82cee9.js"><link rel="prefetch" href="/assets/js/88.970fe73f.js"><link rel="prefetch" href="/assets/js/89.a63f466b.js"><link rel="prefetch" href="/assets/js/9.92ca0399.js"><link rel="prefetch" href="/assets/js/90.122f7138.js"><link rel="prefetch" href="/assets/js/91.1bf31355.js"><link rel="prefetch" href="/assets/js/92.6d409050.js"><link rel="prefetch" href="/assets/js/93.8da495d6.js"><link rel="prefetch" href="/assets/js/94.15b018b4.js"><link rel="prefetch" href="/assets/js/95.b26c17a9.js"><link rel="prefetch" href="/assets/js/96.185a777f.js"><link rel="prefetch" href="/assets/js/97.d60f6b47.js"><link rel="prefetch" href="/assets/js/98.b86ac502.js"><link rel="prefetch" href="/assets/js/99.270839b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5203916d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xxred's notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Easy.Admin</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/easy-admin/" class="nav-link">Easy.Admin文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Easy.Admin</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/easy-admin/" class="nav-link">Easy.Admin文档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>blazor</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dotnet-core/blazor/" class="sidebar-link">/dotnet-core/blazor/</a></li><li><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html" class="active sidebar-link">从 ASP .NET Core Blazor 中的 .NET 方法调用 JavaScript 函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#ijsruntime" class="sidebar-link">IJSRuntime</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#调用无效的-javascript-函数" class="sidebar-link">调用无效的 JavaScript 函数</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#检测-blazor-server-应用何时渲染" class="sidebar-link">检测 Blazor Server 应用何时渲染</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#捕获对元素的引用" class="sidebar-link">捕获对元素的引用</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#跨组件的参考元素" class="sidebar-link">跨组件的参考元素</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#强化-js-互操作调用" class="sidebar-link">强化 JS 互操作调用</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#在类库中共享互操作代码" class="sidebar-link">在类库中共享互操作代码</a></li><li class="sidebar-sub-header"><a href="/dotnet-core/blazor/call-javascript-from-dotnet.html#额外资源" class="sidebar-link">额外资源</a></li></ul></li><li><a href="/dotnet-core/blazor/state-management.html" class="sidebar-link">ASP.NET Core Blazor 状态管理</a></li><li><a href="/dotnet-core/blazor/templated-components.html" class="sidebar-link">ASP.NET Core Blazor 模板组件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从-asp-net-core-blazor-中的-net-方法调用-javascript-函数"><a href="#从-asp-net-core-blazor-中的-net-方法调用-javascript-函数" aria-hidden="true" class="header-anchor">#</a> 从 ASP .NET Core Blazor 中的 .NET 方法调用 JavaScript 函数</h1> <ul><li>Blazor 应用程序可以从 .NET 方法调用 JavaScript 函数，并可以从 JavaScript 函数调用 .NET 方法。这些场景称为 JavaScript 互操作性（JS interop）。</li> <li>本文介绍了从 .NET 调用 JavaScript 函数的方法。有关如何从 JavaScript 调用 .NET 方法的信息，请参见<a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/call-dotnet-from-javascript?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">从 ASP .NET Core Blazor 中的 JavaScript 函数调用 .NET 方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <h2 id="使用"><a href="#使用" aria-hidden="true" class="header-anchor">#</a> 使用</h2> <ul><li>要从 .NET 调用 JavaScript，请使用 IJSRuntime 抽象。要发出 JS 互操作调用，请将 IJSRuntime 抽象注入到组件中。该 InvokeAsync<T>方法获取您希望调用的 JavaScript 函数的标识符以及任意数量的 JSON 可序列化的参数。功能标识符是相对于全局范围（window）的。如果您要呼叫 window.someScope.someFunction，标识符为 someScope.someFunction。无需在调用函数之前先进行注册。返回类型 T 还必须是 JSON 可序列化的。T 应该与最能映射到返回的 JSON 类型的 .NET 类型匹配。</T></li> <li>对于启用了预渲染的 Blazor Server 应用，在初始预渲染期间无法调用 JavaScript。必须将 JavaScript 互操作调用推迟到与浏览器建立连接之后。有关更多信息，请参见<a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/call-javascript-from-dotnet?view=aspnetcore-3.1#detect-when-a-blazor-server-app-is-prerendering" target="_blank" rel="noopener noreferrer">检测 Blazor Server 应用何时渲染<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>部分。</li> <li>以下示例基于基于 JavaScript 的解码器 TextDecoder。该示例演示了如何从 C＃方法调用 JavaScript 函数。JavaScript 函数从 C＃方法接受一个字节数组，对该数组进行解码，然后将文本返回给组件以进行显示。</li> <li>在 wwwroot / index.html（Blazor WebAssembly）或 Pages / _Host.cshtml（Blazor Server）的<head>元素内，提供一个 JavaScript 函数，该函数用于解码传递的数组并返回解码后的值：TextDecoder</head></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">convertArray</span> <span class="token operator">=</span> <span class="token parameter">win1251Array</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> win1251decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token string">'windows-1251'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>win1251Array<span class="token punctuation">)</span>
    <span class="token keyword">var</span> decodedArray <span class="token operator">=</span> win1251decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>decodedArray<span class="token punctuation">)</span>
    <span class="token keyword">return</span> decodedArray
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>JavaScript 代码（例如前面示例中显示的代码）也可以从 JavaScript 文件（.js）加载，并引用该脚本文件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>exampleJsInterop.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p>以下组件：</p> <ul><li>选择组件按钮（“ 转换数组”）时 convertArray 使用调用 JavaScript 函数。JSRuntime</li> <li>调用 JavaScript 函数后，将传递的数组转换为字符串。字符串将返回到组件以显示。</li></ul></li></ul> <div class="language-razor extra-class"><pre class="language-text"><code>@page &quot;/call-js-example&quot;
@inject IJSRuntime JSRuntime;

&lt;h1&gt;Call JavaScript Function Example&lt;/h1&gt;

&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @onclick=&quot;ConvertArray&quot;&gt;
Convert Array
&lt;/button&gt;

&lt;p class=&quot;mt-2&quot; style=&quot;font-size:1.6em&quot;&gt;
    &lt;span class=&quot;badge badge-success&quot;&gt;
        @_convertedText
    &lt;/span&gt;
&lt;/p&gt;

@code {
// Quote (c)2005 Universal Pictures: Serenity
// https://www.uphe.com/movies/serenity
// David Krumholtz on IMDB: https://www.imdb.com/name/nm0472710/

    private MarkupString _convertedText =
        new MarkupString(&quot;Select the &lt;b&gt;Convert Array&lt;/b&gt; button.&quot;);

    private uint[] _quoteArray = new uint[]
        {
            60, 101, 109, 62, 67, 97, 110, 39, 116, 32, 115, 116, 111, 112, 32,
            116, 104, 101, 32, 115, 105, 103, 110, 97, 108, 44, 32, 77, 97,
            108, 46, 60, 47, 101, 109, 62, 32, 45, 32, 77, 114, 46, 32, 85, 110,
            105, 118, 101, 114, 115, 101, 10, 10,
        };

    private async Task ConvertArray()
    {
        var text =
            await JSRuntime.InvokeAsync&lt;string&gt;(&quot;convertArray&quot;, _quoteArray);

        _convertedText = new MarkupString(text);

        StateHasChanged();
    }

}
</code></pre></div><h2 id="ijsruntime"><a href="#ijsruntime" aria-hidden="true" class="header-anchor">#</a> IJSRuntime</h2> <ul><li><p>要使用 IJSRuntime 抽象，请采用以下任何一种方法：</p> <ul><li>将 IJSRuntime 抽象注入 Razor 组件（.razor）：</li></ul></li></ul> <div class="language-razor extra-class"><pre class="language-text"><code>@inject IJSRuntime JSRuntime

@code {
protected override void OnInitialized()
{
StocksService.OnStockTickerUpdated += stockUpdate =&gt;
{
JSRuntime.InvokeVoidAsync(&quot;handleTickerChanged&quot;,
stockUpdate.symbol, stockUpdate.price);
};
}
}
</code></pre></div><p>在 wwwroot / index.html（Blazor WebAssembly）或 Pages / _Host.cshtml（Blazor Server）的</p><head>元素内，提供 JavaScript 函数。该函数使用调用，但不返回值：handleTickerChangedIJSRuntime.InvokeVoidAsync<p></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">handleTickerChanged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">symbol<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... client-side processing/display code ...</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>将 IJSRuntime 抽象注入到类（.cs）中：</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JsInteropClasses</span>
<span class="token punctuation">{</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> IJSRuntime \_jsRuntime<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">JsInteropClasses</span><span class="token punctuation">(</span><span class="token class-name">IJSRuntime</span> jsRuntime<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _jsRuntime <span class="token operator">=</span> jsRuntime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> ValueTask<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">TickerChanged</span><span class="token punctuation">(</span><span class="token keyword">string</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _jsRuntime<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">InvokeAsync</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            <span class="token string">&quot;handleTickerChanged&quot;</span><span class="token punctuation">,</span>
            stockUpdate<span class="token punctuation">.</span>symbol<span class="token punctuation">,</span>
            stockUpdate<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>在 wwwroot / index.html（Blazor WebAssembly）或 Pages / _Host.cshtml（Blazor Server）的</p><head>元素内，提供 JavaScript 函数。该函数使用调用并返回一个值：handleTickerChangedJSRuntime.InvokeAsync<p></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">handleTickerChanged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">symbol<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... client-side processing/display code ...</span>
    <span class="token keyword">return</span> <span class="token string">'Done!'</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>为了使用 BuildRenderTree 动态生成内容，请使用以下[Inject]属性：</li></ul> <div class="language-razor extra-class"><pre class="language-text"><code>[Inject]
IJSRuntime JSRuntime { get; set; }
</code></pre></div><ul><li><p>在此主题附带的客户端示例应用程序中，该应用程序可以使用两个 JavaScript 函数，这些函数与 DOM 交互以接收用户输入并显示欢迎消息：</p> <ul><li>showPrompt –产生提示以接受用户输入（用户名），并将名称返回给呼叫者。</li> <li>displayWelcome-分配从呼叫者到 DOM 对象与一个欢迎消息 id 的 welcome。</li></ul></li> <li><p>wwwroot / exampleJsInterop.js：</p></li></ul> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>exampleJsFunctions <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token function-variable function">showPrompt</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token function">prompt</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">'Type your name here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">displayWelcome</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">welcomeMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'welcome'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> welcomeMessage<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">returnArrayAsyncJs</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
DotNet<span class="token punctuation">.</span><span class="token function">invokeMethodAsync</span><span class="token punctuation">(</span><span class="token string">'BlazorSample'</span><span class="token punctuation">,</span> <span class="token string">'ReturnArrayAsync'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function-variable function">sayHello</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dotnetHelper</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> dotnetHelper<span class="token punctuation">.</span><span class="token function">invokeMethodAsync</span><span class="token punctuation">(</span><span class="token string">'SayHello'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">r</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>将&lt;script&gt;引用 JavaScript 文件的标记放在 wwwroot / index.html 文件（Blazor WebAssembly）或 Pages / _Host.cshtml 文件（Blazor Server）中。</li> <li>wwwroot / index.html（Blazor WebAssembly）：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Blazor WebAssembly Sample<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/bootstrap/bootstrap.min.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/site.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app</span><span class="token punctuation">&gt;</span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>blazor-error-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      An unhandled error has occurred.
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dismiss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>🗙<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_framework/blazor.webassembly.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>exampleJsInterop.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Pages / _Host.cshtml（Blazor 服务器）：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/&quot; @namespace BlazorSample.Pages @addTagHelper \*,
Microsoft.AspNetCore.Mvc.TagHelpers @{ Layout = null; }

<span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Blazor Server Sample<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>~/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/bootstrap/bootstrap.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>css/site.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>typeof(App)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">render-mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ServerPrerendered<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>blazor-error-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Staging,Production<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        An error has occurred. This application may no longer respond until
        reloaded.
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Development<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        An unhandled exception has occurred. See browser dev tools for details.
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>dismiss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>🗙<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_framework/blazor.server.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>exampleJsInterop.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>不要在组件文件中放置&lt;script&gt;标签，因为&lt;script&gt;标签不能动态更新。</li> <li>.NET 方法通过调用来与 exampleJsInterop.js 文件中的 JavaScript 函数进行互操作 IJSRuntime.InvokeAsync<T>。</T></li> <li>该 IJSRuntime 抽象是异步允许 Blazor Server 方案。如果该应用程序是 Blazor WebAssembly 应用程序，并且您要同步调用 JavaScript 函数，请向下转换 IJSInProcessRuntime 并调用 Invoke<T>。我们建议大多数 JS 互操作库使用异步 API，以确保这些库在所有情况下均可用。</T></li> <li>该示例应用程序包含一个演示 JS 互操作的组件。组件：
<ul><li>通过 JavaScript 提示接收用户输入。</li> <li>将文本返回给组件以进行处理。</li> <li>调用与 DOM 交互以显示欢迎消息的第二个 JavaScript 函数。
Pages / JSInterop.razor：</li></ul></li></ul> <div class="language-razor extra-class"><pre class="language-text"><code>@page &quot;/JSInterop&quot;
@using BlazorSample.JsInteropClasses
@inject IJSRuntime JSRuntime

&lt;h1&gt;JavaScript Interop&lt;/h1&gt;

&lt;h2&gt;Invoke JavaScript functions from  .NET methods&lt;/h2&gt;

&lt;button type=&quot;button&quot; class=&quot;btn btn-primary&quot; @onclick=&quot;TriggerJsPrompt&quot;&gt;
Trigger JavaScript Prompt
&lt;/button&gt;

&lt;h3 id=&quot;welcome&quot; style=&quot;color:green;font-style:italic&quot;&gt;&lt;/h3&gt;

@code {
public async Task TriggerJsPrompt()
{
var name = await JSRuntime.InvokeAsync&lt;string&gt;(
&quot;exampleJsFunctions.showPrompt&quot;,
&quot;What's your name?&quot;);

        await JSRuntime.InvokeVoidAsync(
                &quot;exampleJsFunctions.displayWelcome&quot;,
                $&quot;Hello {name}! Welcome to Blazor!&quot;);
    }

}
</code></pre></div><ul><li>当 TriggerJsPrompt 通过选择组件的执行触发的 JavaScript 提示按钮时，JavaScript showPrompt 在所提供的功能的 wwwroot / exampleJsInterop.js 文件被调用。</li> <li>该 showPrompt 函数接受经过 HTML 编码并返回到组件的用户输入（用户名）。该组件将用户名存储在本地变量中 name。</li> <li>存储在其中的字符串 name 被合并到欢迎消息中，该消息将传递给 JavaScript 函数 displayWelcome，该函数将欢迎消息呈现为标题标记。</li></ul> <h2 id="调用无效的-javascript-函数"><a href="#调用无效的-javascript-函数" aria-hidden="true" class="header-anchor">#</a> 调用无效的 JavaScript 函数</h2> <ul><li>返回 void（0）/ void 0 或 undefined 的 JavaScript 函数用调用 IJSRuntime.InvokeVoidAsync。</li></ul> <h2 id="检测-blazor-server-应用何时渲染"><a href="#检测-blazor-server-应用何时渲染" aria-hidden="true" class="header-anchor">#</a> 检测 Blazor Server 应用何时渲染</h2> <ul><li>在渲染 Blazor Server 应用程序时，由于尚未建立与浏览器的连接，因此无法执行某些操作（如调用 JavaScript）。预渲染时，组件可能需要进行不同的渲染。</li> <li>若要将 JavaScript 互操作调用延迟到与浏览器建立连接之后，可以使用 OnAfterRenderAsync 组件生命周期事件。仅在完全渲染应用程序并建立客户端连接后才调用此事件。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@using Microsoft.JSInterop @inject IJSRuntime JSRuntime

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>divElement<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Text during render<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

@code { private ElementReference divElement; protected override async Task
OnAfterRenderAsync(bool firstRender) { if (firstRender) { await
JSRuntime.InvokeVoidAsync( &quot;setElementText&quot;, divElement, &quot;Text after render&quot;); }
} }
</code></pre></div><ul><li>对于前面的示例代码，请 setElementText 在 wwwroot / index.html（Blazor WebAssembly）或 Pages / _Host.cshtml（Blazor Server）的&lt;head&gt;元素内提供一个 JavaScript 函数。该函数使用调用，但不返回值：IJSRuntime.InvokeVoidAsync</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">setElementText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> text<span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>警告：前面的示例仅出于演示目的直接修改了文档对象模型（DOM）。在大多数情况下，建议不要使用 JavaScript 直接修改 DOM，因为 JavaScript 可能会干扰 Blazor 的更改跟踪。</p></blockquote> <ul><li>以下组件演示了如何以与预渲染兼容的方式将 JavaScript 互操作用作组件初始化逻辑的一部分。该组件表明可以从内部触发渲染更新 OnAfterRenderAsync。在这种情况下，开发人员必须避免创建无限循环。</li> <li>仅在，而不是在任何较早的生命周期方法中使用 where JSRuntime.InvokeAsync，因为在呈现组件之前没有 JavaScript 元素。ElementRefOnAfterRenderAsync</li> <li>调用 StateHasChanged 以使用从 JavaScript 互操作调用获得的新状态来重新呈现组件。该代码不会创建无限循环，因为 StateHasChanged 仅当 infoFromJsis 时才调用 null。</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/prerendered-interop&quot; @using Microsoft.AspNetCore.Components @using
Microsoft.JSInterop @inject IJSRuntime JSRuntime

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  Get value via JS interop call:
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val-get-by-interop<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>@(infoFromJs ?? &quot;No value yet&quot;)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

Set value via JS interop call:

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>val-set-by-interop<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>divElement<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

@code { private string infoFromJs; private ElementReference divElement;
protected override async Task OnAfterRenderAsync(bool firstRender) { if
(firstRender &amp;&amp; infoFromJs == null) { infoFromJs = await
JSRuntime.InvokeAsync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span>
  <span class="token punctuation">&gt;</span></span>( &quot;setElementText&quot;, divElement, &quot;Hello from interop call!&quot;);
  StateHasChanged(); } } }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span>
<span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对于前面的示例代码，请 setElementText 在 wwwroot / index.html（Blazor WebAssembly）或 Pages / _Host.cshtml（Blazor Server）的</p><head>元素内提供一个 JavaScript 函数。该函数使用调用并返回一个值：IJSRuntime.InvokeAsync<p></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">setElementText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>innerText <span class="token operator">=</span> text
    <span class="token keyword">return</span> text
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>警告：前面的示例仅出于演示目的直接修改了文档对象模型（DOM）。在大多数情况下，建议不要使用 JavaScript 直接修改 DOM，因为 JavaScript 可能会干扰 Blazor 的更改跟踪。</p></blockquote> <h2 id="捕获对元素的引用"><a href="#捕获对元素的引用" aria-hidden="true" class="header-anchor">#</a> 捕获对元素的引用</h2> <ul><li>某些 JS 互操作方案需要引用 HTML 元素。例如，UI 库可能需要元素引用进行初始化，或者您可能需要在诸如 focus 或的元素上调用类似命令的 API play。</li> <li>使用以下方法捕获对组件中 HTML 元素的引用：
<ul><li>将@ref 属性添加到 HTML 元素。</li> <li>定义 ElementReference 名称与@ref 属性值匹配的类型的字段。</li></ul></li> <li>以下示例显示了捕获对 username &lt;input&gt;元素的引用：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">...</span> <span class="token punctuation">/&gt;</span></span>

@code { ElementReference username; }
</code></pre></div><ul><li>警告：仅使用元素引用来改变不与 Blazor 交互的空元素的内容。当第三方 API 向元素提供内容时，此方案很有用。因为 Blazor 不与元素交互，所以 Blazor 的元素表示与 DOM 之间不会发生冲突。
在以下示例中，突变无序列表（）的内容很危险，ul 因为 Blazor 与 DOM 交互以填充此元素的列表项（&lt;li&gt;）：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>MyList<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  @foreach (var item in Todos) {
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>@item.Text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  }
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p>如果 JS 互操作 MyList 更改了 element 的内容，并且 Blazor 尝试将 diff 应用于该元素，则该 diff 将与 DOM 不匹配。</p></li> <li><p>就 .NET 代码而言，an ElementReference 是一个不透明的句柄。在只有你可以做的事情 ElementReference 就是通过 JS 互操作，让它通过 JavaScript 代码。当您这样做时，JavaScript 端代码会收到一个 HTMLElement 实例，该实例可与普通 DOM API 一起使用。</p></li> <li><p>例如，以下代码定义了 .NET 扩展方法，该方法允许将焦点设置在元素上：</p></li></ul> <p>exampleJsInterop.js：</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>exampleJsFunctions <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token function-variable function">focusElement</span> <span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
element<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>要调用不返回值的 JavaScript 函数，请使用 IJSRuntime.InvokeVoidAsync。以下代码通过调用捕获的前面的 JavaScript 函数，将焦点放在用户名输入上 ElementReference：</p> <div class="language-html extra-class"><pre class="language-html"><code>@inject IJSRuntime JSRuntime

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>\_username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SetFocus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Set focus on username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

@code { private ElementReference \_username; public async Task SetFocus() {
await JSRuntime.InvokeVoidAsync( &quot;exampleJsFunctions.focusElement&quot;, _username);
} }
</code></pre></div><ul><li>要使用扩展方法，请创建一个接收 IJSRuntime 实例的静态扩展方法：</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">Focus</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">ElementReference</span> elementRef<span class="token punctuation">,</span> <span class="token class-name">IJSRuntime</span> jsRuntime<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">await</span> jsRuntime<span class="token punctuation">.</span><span class="token function">InvokeVoidAsync</span><span class="token punctuation">(</span>
<span class="token string">&quot;exampleJsFunctions.focusElement&quot;</span><span class="token punctuation">,</span> elementRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>该 Focus 方法直接在对象上调用。下面的示例假定该 Focus 方法可从 JsInteropClasses 名称空间使用：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@inject IJSRuntime JSRuntime @using JsInteropClasses

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>\_username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SetFocus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Set focus on username<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

@code { private ElementReference \_username; public async Task SetFocus() {
await _username.Focus(JSRuntime); } }
</code></pre></div><ul><li>使用泛型类型并返回值时，请使用 ValueTask <T>：</T></li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> ValueTask<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token generic-method"><span class="token function">GenericMethod</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">ElementReference</span> elementRef<span class="token punctuation">,</span>
<span class="token class-name">IJSRuntime</span> jsRuntime<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">return</span> jsRuntime<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">InvokeAsync</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
<span class="token string">&quot;exampleJsFunctions.doSomethingGeneric&quot;</span><span class="token punctuation">,</span> elementRef<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>GenericMethod 直接在具有类型的对象上调用。以下示例假定 GenericMethod 可以从 JsInteropClasses 名称空间获得：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@inject IJSRuntime JSRuntime @using JsInteropClasses

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>\_username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>OnClickMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Do something generic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  _returnValue: @_returnValue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

@code { private ElementReference \_username; private string \_returnValue;
private async Task OnClickMethod() { _returnValue = await
_username.GenericMethod<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>(JSRuntime); } }<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="跨组件的参考元素"><a href="#跨组件的参考元素" aria-hidden="true" class="header-anchor">#</a> 跨组件的参考元素</h2> <ul><li>一个 ElementReference 时，才能保证在组件的有效 OnAfterRender 方法（和元件参考是 struct），所以一个元件引用不能部件之间传递。</li> <li>为了使父组件使元素引用可用于其他组件，父组件可以：
<ul><li>允许子组件注册回调。</li> <li>在 OnAfterRender 事件期间使用传递的元素引用来调用已注册的回调。间接地，这种方法允许子组件与父组件的元素引用进行交互。</li></ul></li> <li>以下 Blazor WebAssembly 示例说明了该方法。</li> <li>在&lt;head&gt;的 wwwroot 文件/ index.html 的：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.red</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>在&lt;body&gt;的 wwwroot 文件/ index.html 的：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">setElementClass</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> className</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/** @type {HTMLElement} **/</span>
    <span class="token keyword">var</span> myElement <span class="token operator">=</span> element
    myElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Pages / Index.razor（父组件）：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/&quot;

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">@ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Hello, world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

Welcome to your new app.

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SurveyPrompt</span> <span class="token attr-name">Parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>this<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>How is Blazor working for you?<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
Pages / Index.razor.cs：
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> BlazorSample<span class="token punctuation">.</span>Pages
<span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">:</span>
<span class="token class-name">ComponentBase</span><span class="token punctuation">,</span> IObservable<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span><span class="token punctuation">,</span> IDisposable
<span class="token punctuation">{</span>
<span class="token keyword">private</span> <span class="token keyword">bool</span> \_disposing<span class="token punctuation">;</span>
<span class="token keyword">private</span> IList<span class="token operator">&lt;</span>IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;&gt;</span> \_subscriptions <span class="token operator">=</span>
<span class="token keyword">new</span> <span class="token class-name">List</span><span class="token operator">&lt;</span>IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> ElementReference \_title<span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">OnAfterRender</span><span class="token punctuation">(</span><span class="token keyword">bool</span> firstRender<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnAfterRender</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> subscription <span class="token keyword">in</span> _subscriptions<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    subscription<span class="token punctuation">.</span><span class="token function">OnNext</span><span class="token punctuation">(</span>_title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _disposing <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>

            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> subscription <span class="token keyword">in</span> _subscriptions<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    subscription<span class="token punctuation">.</span><span class="token function">OnCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            _subscriptions<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">IDisposable</span> <span class="token function">Subscribe</span><span class="token punctuation">(</span>IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span> observer<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>_disposing<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;Parent being disposed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            _subscriptions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Subscription</span><span class="token punctuation">(</span>observer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Subscription</span> <span class="token punctuation">:</span> <span class="token class-name">IDisposable</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token function">Subscription</span><span class="token punctuation">(</span>IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span> observer<span class="token punctuation">,</span> <span class="token class-name">Index</span> self<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Observer <span class="token operator">=</span> observer<span class="token punctuation">;</span>
                Self <span class="token operator">=</span> self<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">public</span> IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span> Observer <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token class-name">Index</span> Self <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Self<span class="token punctuation">.</span>_subscriptions<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>Observer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>共享/SurveyPrompt.razor（子组件）：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>@inject IJSRuntime JS

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert alert-secondary mt-4<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>alert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>oi oi-pencil mr-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">aria-hidden</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>@Title<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text-nowrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    Please take our
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span>
      <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>font-weight-bold<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://go.microsoft.com/fwlink/?linkid=2109206<span class="token punctuation">&quot;</span></span>
      <span class="token punctuation">&gt;</span></span>brief survey<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>
    <span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  and tell us what you think.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

@code { [Parameter] public string Title { get; set; } }
</code></pre></div><ul><li>共享/SurveyPrompt.razor.cs：</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> BlazorSample<span class="token punctuation">.</span>Shared
<span class="token punctuation">{</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">SurveyPrompt</span> <span class="token punctuation">:</span>
<span class="token class-name">ComponentBase</span><span class="token punctuation">,</span> IObserver<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span><span class="token punctuation">,</span> IDisposable
<span class="token punctuation">{</span>
<span class="token keyword">private</span> IDisposable \_subscription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token class-name">Parameter</span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> IObservable<span class="token operator">&lt;</span>ElementReference<span class="token operator">&gt;</span> Parent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">OnParametersSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnParametersSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>_subscription <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                _subscription<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            _subscription <span class="token operator">=</span> Parent<span class="token punctuation">.</span><span class="token function">Subscribe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _subscription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnError</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> error<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _subscription <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">OnNext</span><span class="token punctuation">(</span><span class="token class-name">ElementReference</span> <span class="token keyword">value</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            JS<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">InvokeAsync</span><span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                <span class="token string">&quot;setElementClass&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token string">&quot;red&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _subscription<span class="token punctuation">?.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="强化-js-互操作调用"><a href="#强化-js-互操作调用" aria-hidden="true" class="header-anchor">#</a> 强化 JS 互操作调用</h2> <ul><li>JS 互操作可能由于网络错误而失败，应视为不可靠。默认情况下，Blazor Server 应用程序在一分钟后使服务器上的 JS 互操作调用超时。如果应用程序可以忍受更激进的超时（例如 10 秒），请使用以下方法之一设置超时：
<ul><li>在全局中 Startup.ConfigureServices，指定超时时间：</li></ul></li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddServerSideBlazor</span><span class="token punctuation">(</span>
options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span>JSInteropDefaultCallTimeout <span class="token operator">=</span> TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token punctuation">{</span>SECONDS<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>对于组件代码中的每次调用，单个调用可以指定超时：</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> JSRuntime<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">InvokeAsync</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;MyJSOperation&quot;</span><span class="token punctuation">,</span>
TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token punctuation">{</span>SECONDS<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;Arg1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>有关资源耗尽的更多信息，请参见 <a href="https://docs.microsoft.com/en-us/aspnet/core/security/blazor/server?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">Secure ASP .NET Core Blazor Server 应用程序<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <h2 id="在类库中共享互操作代码"><a href="#在类库中共享互操作代码" aria-hidden="true" class="header-anchor">#</a> 在类库中共享互操作代码</h2> <ul><li>JS 互操作代码可以包含在类库中，该库使您可以在 NuGet 包中共享代码。</li> <li>类库处理将 JavaScript 资源嵌入到已生成的程序集中。JavaScript 文件位于 wwwroot 文件夹中。构建库时，该工具负责嵌入资源。</li> <li>在应用程序的项目文件中引用生成的 NuGet 包的方式与引用任何 NuGet 包的方式相同。还原软件包后，应用程序代码可以像 C＃一样调用 JavaScript。</li> <li>有关更多信息，请参见 <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/class-libraries?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">ASP .NET Core Razor 组件类库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</li></ul> <h2 id="额外资源"><a href="#额外资源" aria-hidden="true" class="header-anchor">#</a> 额外资源</h2> <ul><li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/call-dotnet-from-javascript?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">从 ASP .NET Core Blazor 中的 JavaScript 函数调用 .NET 方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/dotnet/AspNetCore/blob/release/3.1/src/Components/test/testassets/BasicTestApp/InteropComponent.razor" target="_blank" rel="noopener noreferrer">InteropComponent.razor 示例（dotnet / AspNetCore GitHub 存储库，3.1 版本分支）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/advanced-scenarios?view=aspnetcore-3.1#perform-large-data-transfers-in-blazor-server-apps" target="_blank" rel="noopener noreferrer">在 Blazor Server 应用程序中执行大数据传输<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>参考 https://docs.microsoft.com/en-us/aspnet/core/blazor/call-javascript-from-dotnet?view=aspnetcore-3.1</p></head></head></head></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xxred/xxred.github.io/edit/master/docs/dotnet-core/blazor/call-javascript-from-dotnet.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2/29/2020, 4:42:46 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dotnet-core/blazor/" class="prev router-link-active">
          /dotnet-core/blazor/
        </a></span> <span class="next"><a href="/dotnet-core/blazor/state-management.html">
          ASP.NET Core Blazor 状态管理
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7ecefee6.js" defer></script><script src="/assets/js/2.bd7d8131.js" defer></script><script src="/assets/js/83.8607788b.js" defer></script>
  </body>
</html>
